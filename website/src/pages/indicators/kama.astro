---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'kama';
const indicatorName = 'Kaufman Adaptive Moving Average';
const description = `The Kaufman Adaptive Moving Average (KAMA) is an intelligent moving average that automatically adjusts its speed based on market volatility and trend strength, becoming faster during trends and slower during consolidations to reduce whipsaws.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 10,
    "min": 2,
    "max": 200,
    "description": "Efficiency Ratio calculation period"
  },
  {
    "name": "fast_period",
    "type": "number",
    "default": 2,
    "min": 2,
    "max": 50,
    "description": "Fast EMA period for trending markets"
  },
  {
    "name": "slow_period",
    "type": "number",
    "default": 30,
    "min": 10,
    "max": 200,
    "description": "Slow EMA period for ranging markets"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    The Kaufman Adaptive Moving Average (KAMA), developed by Perry Kaufman, is a sophisticated 
    trend-following indicator that solves the age-old problem of choosing between responsive and 
    smooth moving averages. KAMA automatically adjusts its sensitivity based on the Efficiency 
    Ratio (ER), which measures the directional movement versus total volatility.
  </p>
  <p>
    During strong trends, KAMA behaves like a fast moving average, staying close to price and 
    providing timely signals. During sideways markets, it acts like a slow moving average, 
    filtering out market noise and reducing false signals. This adaptive behavior makes KAMA 
    particularly effective for trend-following systems that need to work across different market 
    conditions without constant parameter adjustment.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Adaptive Behavior</h3>
  <ul>
    <li><strong>Trending markets:</strong> KAMA moves closer to price, similar to fast EMA</li>
    <li><strong>Ranging markets:</strong> KAMA becomes smoother, similar to slow EMA</li>
    <li><strong>Efficiency Ratio:</strong> High ER (near 1) = strong trend, Low ER (near 0) = choppy market</li>
    <li><strong>Noise filtering:</strong> Automatically reduces sensitivity in noisy conditions</li>
  </ul>

  <h3>Trading Signals</h3>
  <ul>
    <li><strong>Trend direction:</strong> Rising KAMA = uptrend, Falling KAMA = downtrend</li>
    <li><strong>Price crossovers:</strong> Price crossing KAMA generates entry/exit signals</li>
    <li><strong>KAMA turns:</strong> Changes in KAMA direction signal potential reversals</li>
    <li><strong>Support/Resistance:</strong> KAMA acts as dynamic support in uptrends</li>
  </ul>

  <h3>Advantages</h3>
  <ul>
    <li><strong>Self-adjusting:</strong> No need to manually switch between fast/slow settings</li>
    <li><strong>Reduced whipsaws:</strong> Fewer false signals in ranging markets</li>
    <li><strong>Trend preservation:</strong> Stays with trends longer than fixed MAs</li>
    <li><strong>Versatility:</strong> Works across different markets and timeframes</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>KAMA calculation involves three main steps:</p>
  <ol>
    <li><strong>Calculate Efficiency Ratio (ER):</strong>
      <ul>
        <li>Direction = abs(Close - Close[n periods ago])</li>
        <li>Volatility = Sum of abs(Close - Close[1]) over n periods</li>
        <li>ER = Direction / Volatility</li>
      </ul>
    </li>
    <li><strong>Calculate Smoothing Constant (SC):</strong>
      <ul>
        <li>FastSC = 2 / (fast_period + 1)</li>
        <li>SlowSC = 2 / (slow_period + 1)</li>
        <li>SC = [ER × (FastSC - SlowSC) + SlowSC]²</li>
      </ul>
    </li>
    <li><strong>Calculate KAMA:</strong>
      <ul>
        <li>KAMA = KAMA[1] + SC × (Price - KAMA[1])</li>
      </ul>
    </li>
  </ol>
  <p>
    The squaring of SC in step 2 provides a more gradual transition between fast and slow speeds, 
    preventing abrupt changes in KAMA's behavior. This creates the smooth, adaptive response that 
    makes KAMA so effective.
  </p>

  <h2 id="parameters">Parameters</h2>
  <ul>
    <li>
      <strong>Period (default: 10):</strong> The lookback period for calculating the Efficiency 
      Ratio. This determines how many bars are used to measure trend efficiency. Common values 
      range from 8-21. Shorter periods make KAMA more reactive to recent changes, while longer 
      periods provide more stable efficiency measurements.
    </li>
    <li>
      <strong>Fast Period (default: 2):</strong> The EMA equivalent period used when the market 
      is trending strongly (ER = 1). This represents the fastest KAMA can move. The traditional 
      value is 2, making KAMA very responsive during strong trends. Values of 3-5 reduce noise 
      while maintaining responsiveness.
    </li>
    <li>
      <strong>Slow Period (default: 30):</strong> The EMA equivalent period used when the market 
      is completely random (ER = 0). This represents the slowest KAMA can move. The traditional 
      value is 30, providing significant smoothing in choppy markets. Values of 20-50 are common, 
      with higher values providing more noise reduction.
    </li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The indicator returns an array of KAMA values:</p>
  <ul>
    <li><strong>Type:</strong> Array of floating-point numbers</li>
    <li><strong>Length:</strong> Same as input array</li>
    <li><strong>Initial values:</strong> First 'period' values may be less stable</li>
    <li><strong>Characteristics:</strong> Adaptive smoothing between fast and slow speeds</li>
    <li><strong>Range:</strong> Follows price range, no fixed bounds</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. Adaptive Trend Following</h3> <p>Using KAMA for trend identification and entry:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. KAMA Band Trading</h3> <p>Creating adaptive bands around KAMA:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. Multi-KAMA System</h3> <p>Using multiple KAMA settings for confirmation:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>Initialization period:</strong> Requires 'period' bars for stable ER calculation</li>
    <li><strong>Extreme ER values:</strong> Very high/low ER can cause abrupt KAMA changes</li>
    <li><strong>Parameter sensitivity:</strong> Fast period too low can increase noise</li>
    <li><strong>Whipsaws at ER transitions:</strong> When ER shifts between high and low</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Use default parameters (10, 2, 30) as starting point</li>
    <li>Monitor ER values to understand KAMA behavior</li>
    <li>Combine with volume indicators for confirmation</li>
    <li>Use wider stops in low ER (choppy) conditions</li>
    <li>Consider KAMA slope for trend strength assessment</li>
    <li>Test parameter combinations for your specific market</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Kaufman, P. J. (1995). <em>Smarter Trading</em>. McGraw-Hill.</li>
    <li>Kaufman, P. J. (2013). <em>Trading Systems and Methods</em>. 5th Edition. Wiley.</li>
    <li>Efficiency Ratio and adaptive filtering techniques</li>
    <li>Comparison studies: KAMA vs. other adaptive moving averages</li>
  </ul>
</IndicatorLayout>
