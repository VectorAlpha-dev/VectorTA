---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'atr';
const indicatorName = 'Average True Range (ATR)';
const description = `The Average True Range (ATR) is a volatility indicator developed by J. Welles Wilder Jr. that measures market volatility by analyzing the entire range of an asset's price movement. Unlike other volatility measures, ATR captures gaps and limit moves, providing a comprehensive view of price volatility regardless of direction.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 14,
    "min": 5,
    "max": 50,
    "description": "Number of periods for averaging the true range"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Average True Range (ATR) is one of the most widely used volatility indicators in technical analysis. Developed by 
    J. Welles Wilder Jr. in 1978, ATR measures market volatility by calculating the average of true ranges over a specified 
    period. Unlike simple range calculations, ATR accounts for gaps and limit moves, making it a more comprehensive measure 
    of volatility.
  </p>
  <p>
    ATR is unique because it measures volatility without regard to price direction. A rising ATR indicates increasing 
    volatility (regardless of whether prices are rising or falling), while a falling ATR suggests decreasing volatility. 
    This makes it invaluable for position sizing, stop-loss placement, and identifying potential breakouts.
  </p>

  <h2>How It Works</h2>
  <p>ATR calculation involves two steps:</p>
  <ol>
    <li><strong>Calculate True Range (TR):</strong> The greatest of:
      <ul>
        <li>Current High - Current Low</li>
        <li>|Current High - Previous Close|</li>
        <li>|Current Low - Previous Close|</li>
      </ul>
    </li>
    <li><strong>Calculate ATR:</strong> Apply Wilder's smoothing method (or EMA) to the True Range values</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200">
      True Range = MAX(<br/>
      &nbsp;&nbsp;High - Low,<br/>
      &nbsp;&nbsp;|High - Previous Close|,<br/>
      &nbsp;&nbsp;|Low - Previous Close|<br/>
      )<br/>
      <br/>
      ATR = ((Previous ATR × (n-1)) + Current TR) / n<br/>
      <br/>
      Where n = period (typically 14)
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Direction Neutral:</strong> Measures volatility regardless of price direction</li>
    <li><strong>Gap Inclusive:</strong> Captures overnight gaps and limit moves</li>
    <li><strong>Smoothed Output:</strong> Uses averaging to reduce noise</li>
    <li><strong>Absolute Values:</strong> Always positive, expressed in price units</li>
  </ul>

  <h2>Interpretation & Trading Applications</h2>
  
  <h3>Volatility Analysis</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">ATR Readings:</h4>
    <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Rising ATR:</strong> Increasing volatility (trend strengthening or reversal)</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Falling ATR:</strong> Decreasing volatility (consolidation or trend weakening)</li>
      <li><strong class="text-gray-900 dark:text-gray-100">High ATR:</strong> Volatile market conditions (wider stops needed)</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Low ATR:</strong> Quiet market conditions (potential breakout setup)</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Trading Applications:</h4>
    <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Stop Loss Placement:</strong> Set stops at multiples of ATR (e.g., 2×ATR)</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Position Sizing:</strong> Adjust position size based on ATR (higher ATR = smaller position)</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Profit Targets:</strong> Set targets at ATR multiples</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Breakout Confirmation:</strong> Rising ATR confirms breakout validity</li>
    </ul>
  </div>

  <h3>ATR-Based Trading Strategies</h3>
  <ul>
    <li><strong>Chandelier Exit:</strong>
      <ul>
        <li>Long Stop: Highest High - (ATR × Multiplier)</li>
        <li>Short Stop: Lowest Low + (ATR × Multiplier)</li>
      </ul>
    </li>
    <li><strong>ATR Trailing Stop:</strong> Trail stop loss by ATR multiples as trade moves in favor</li>
    <li><strong>Volatility Breakout:</strong> Enter when price moves more than 1 ATR from opening price</li>
    <li><strong>ATR Channel Breakout:</strong> Trade breakouts from channels based on ATR width</li>
  </ul>

  <h3>Risk Management with ATR</h3>
  <ul>
    <li><strong>Position Sizing Formula:</strong> Risk Amount / (ATR × Multiplier) = Number of Shares</li>
    <li><strong>Dynamic Stops:</strong> Adjust stop distance based on current ATR</li>
    <li><strong>Volatility Filters:</strong> Only trade when ATR is within acceptable range</li>
    <li><strong>Time-Based Exits:</strong> Exit if ATR drops below threshold (momentum lost)</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Provides objective measure of volatility</li>
    <li>Excellent for position sizing and risk management</li>
    <li>Works across all markets and timeframes</li>
    <li>Simple to calculate and interpret</li>
    <li>Captures gaps and limit moves effectively</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Lagging indicator (based on historical data)</li>
    <li>No directional information provided</li>
    <li>Can spike on single volatile days</li>
    <li>Absolute values make cross-market comparison difficult</li>
    <li>Requires additional indicators for entry signals</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>ATR works best when combined with directional indicators:</p>
  <ul>
    <li><strong>Moving Averages:</strong> Direction from MA, volatility from ATR</li>
    <li><strong>Bollinger Bands:</strong> Compare ATR volatility with band width</li>
    <li><strong>ADX:</strong> ADX for trend strength, ATR for volatility</li>
    <li><strong>Breakout Systems:</strong> Use ATR to confirm and size breakout trades</li>
    <li><strong>Support/Resistance:</strong> ATR helps set realistic profit targets from levels</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>
  </div>

  <h2>Mathematical Background</h2>
  <p>
    The genius of ATR lies in its True Range concept. By considering the maximum of three different range calculations, 
    Wilder ensured that ATR captures all significant price movements, including gaps. This is crucial in markets that 
    can gap significantly between sessions.
  </p>
  <p>
    Wilder's smoothing method (used in the original ATR) applies a form of exponential smoothing where the most recent 
    True Range value has a weight of 1/n and the previous ATR has a weight of (n-1)/n. This creates a smooth, responsive 
    measure that doesn't overreact to single volatile days while still adapting to changing market conditions.
  </p>

</IndicatorLayout>