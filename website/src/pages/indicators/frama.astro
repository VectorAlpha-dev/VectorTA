---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'frama';
const indicatorName = 'Fractal Adaptive Moving Average (FRAMA)';
const description = `The Fractal Adaptive Moving Average (FRAMA), developed by John Ehlers, uses fractal geometry to create a moving average that adapts to market conditions. By measuring the fractal dimension of price movements, FRAMA automatically adjusts its smoothing factor, responding quickly to trends while remaining stable during consolidations.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 16,
    "min": 8,
    "max": 64,
    "description": "Base period for fractal calculation (should be even)"
  },
  {
    "name": "fast_period",
    "type": "number",
    "default": 1,
    "min": 1,
    "max": 10,
    "description": "Fast EMA period for high fractal dimension"
  },
  {
    "name": "slow_period",
    "type": "number",
    "default": 198,
    "min": 50,
    "max": 300,
    "description": "Slow EMA period for low fractal dimension"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Fractal Adaptive Moving Average (FRAMA) represents one of the most sophisticated adaptive indicators in 
    technical analysis, applying chaos theory and fractal geometry to financial markets. Developed by John Ehlers, 
    FRAMA recognizes that market prices exhibit fractal characteristics—similar patterns appearing at different scales. 
    By measuring the fractal dimension of price movements, FRAMA can distinguish between trending markets (which have 
    a lower fractal dimension) and choppy markets (which have a higher fractal dimension), automatically adjusting 
    its behavior accordingly.
  </p>
  <p>
    What makes FRAMA revolutionary is its ability to solve the eternal dilemma of moving averages: the trade-off 
    between responsiveness and smoothness. During trends, when price movements become more "line-like" (fractal 
    dimension approaching 1), FRAMA speeds up to stay close to price. During consolidations, when price movements 
    become more "space-filling" (fractal dimension approaching 2), FRAMA slows down to avoid whipsaws. This creates 
    an intelligent moving average that adapts to market conditions without lag during important moves.
  </p>

  <h2>How It Works</h2>
  <p>FRAMA uses fractal dimension to adapt its smoothing dynamically:</p>
  <ol>
    <li><strong>Divide Period:</strong> Split lookback into two halves</li>
    <li><strong>Calculate Ranges:</strong> Find max-min for each half and full period</li>
    <li><strong>Compute Fractal Dimension:</strong> Use ranges to estimate dimension</li>
    <li><strong>Derive Alpha:</strong> Convert dimension to adaptive smoothing factor</li>
    <li><strong>Apply EMA:</strong> Use adaptive alpha for exponential smoothing</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200">
      Step 1: Calculate price ranges<br/>
      N = period (must be even)<br/>
      N1 = Highest(N/2) - Lowest(N/2) [first half]<br/>
      N2 = Highest(N/2) - Lowest(N/2) [second half]<br/>
      N3 = Highest(N) - Lowest(N) [full period]<br/>
      <br/>
      Step 2: Calculate fractal dimension<br/>
      If (N1 &gt; 0 and N2 &gt; 0 and N3 &gt; 0):<br/>
        D = (log(N1 + N2) - log(N3)) / log(2)<br/>
      <br/>
      Step 3: Calculate adaptive alpha<br/>
      α = exp(-4.6 × (D - 1))<br/>
      <br/>
      Constrain α to range [2/(slow_period+1), 2/(fast_period+1)]<br/>
      <br/>
      Step 4: Apply adaptive EMA<br/>
      FRAMA = α × Price + (1 - α) × FRAMA[1]<br/>
      <br/>
      Fractal Dimension:<br/>
      D ≈ 1.0: Strong trend (FRAMA speeds up)<br/>
      D ≈ 1.5: Normal market (moderate smoothing)<br/>
      D ≈ 2.0: Choppy market (FRAMA slows down)
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Fractal Adaptation:</strong> Uses chaos theory for market analysis</li>
    <li><strong>Automatic Adjustment:</strong> No manual parameter optimization needed</li>
    <li><strong>Minimal Lag:</strong> Fast response during trending periods</li>
    <li><strong>Noise Reduction:</strong> Excellent filtering during consolidations</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>FRAMA Analysis</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Trend Identification:</h4>
    <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Rising FRAMA:</strong> Uptrend in progress</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Falling FRAMA:</strong> Downtrend in progress</li>
      <li><strong class="text-gray-900 dark:text-gray-100">FRAMA Close to Price:</strong> Strong trending market</li>
      <li><strong class="text-gray-900 dark:text-gray-100">FRAMA Far from Price:</strong> Potential reversal setup</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Trading Signals:</h4>
    <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Price Cross Above FRAMA:</strong> Bullish signal</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Price Cross Below FRAMA:</strong> Bearish signal</li>
      <li><strong class="text-gray-900 dark:text-gray-100">FRAMA Direction Change:</strong> Early trend reversal</li>
      <li><strong class="text-gray-900 dark:text-gray-100">FRAMA as Support/Resistance:</strong> Dynamic price levels</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Trend Following:</strong>
      <ul>
        <li>Buy when price crosses above rising FRAMA</li>
        <li>Sell when price crosses below falling FRAMA</li>
        <li>Use FRAMA as trailing stop</li>
        <li>Stay in position while price remains on correct side</li>
      </ul>
    </li>
    <li><strong>Pullback Trading:</strong>
      <ul>
        <li>Wait for established trend (FRAMA sloping)</li>
        <li>Buy pullbacks to FRAMA in uptrends</li>
        <li>Sell rallies to FRAMA in downtrends</li>
        <li>Exit if price closes beyond FRAMA</li>
      </ul>
    </li>
    <li><strong>FRAMA Squeeze:</strong>
      <ul>
        <li>Identify when FRAMA flattens (consolidation)</li>
        <li>Wait for FRAMA to start sloping</li>
        <li>Enter in direction of new slope</li>
        <li>Expect strong move as fractal dimension drops</li>
      </ul>
    </li>
    <li><strong>Multiple FRAMA:</strong> Use different periods for confirmation</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>FRAMA Bands:</strong> Add ATR or percentage bands</li>
    <li><strong>Fractal Dimension Plot:</strong> Display D value separately</li>
    <li><strong>FRAMA Momentum:</strong> Measure rate of change of FRAMA</li>
    <li><strong>Composite FRAMA:</strong> Combine multiple timeframe FRAMAs</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Superior adaptation to market conditions</li>
    <li>Minimal lag during trends</li>
    <li>Excellent noise filtering in ranges</li>
    <li>Based on sound mathematical theory</li>
    <li>Works across all markets and timeframes</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Complex calculation requires understanding</li>
    <li>Period must be even number</li>
    <li>May overadapt in very noisy markets</li>
    <li>Fractal calculation sensitive to outliers</li>
    <li>Requires more computation than simple MAs</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>FRAMA works exceptionally well with:</p>
  <ul>
    <li><strong>RSI/MACD:</strong> FRAMA for trend, oscillators for timing</li>
    <li><strong>ATR:</strong> Combine FRAMA with volatility bands</li>
    <li><strong>Other Adaptive MAs:</strong> Compare FRAMA with KAMA, VIDYA</li>
    <li><strong>Support/Resistance:</strong> FRAMA behavior at key levels</li>
    <li><strong>Volume:</strong> Confirm FRAMA signals with volume</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical brilliance of FRAMA lies in its application of fractal geometry to financial time series. 
    Fractal dimension, a concept from chaos theory, measures how completely a curve fills space. A straight line 
    has dimension 1, while a curve that wanders randomly has a dimension approaching 2. By calculating this 
    dimension for price movements, FRAMA quantifies whether the market is trending (low dimension) or consolidating 
    (high dimension).
  </p>
  <p>
    The formula D = (log(N1 + N2) - log(N3)) / log(2) elegantly captures this concept using the relationship between 
    price ranges at different scales. When price moves in a straight line, N3 ≈ N1 + N2, giving D ≈ 1. When price 
    oscillates randomly, N3 &lt;&lt; N1 + N2, giving D ≈ 2. The exponential transformation α = exp(-4.6 × (D - 1)) 
    converts this dimension into an optimal smoothing factor, creating an adaptive moving average that automatically 
    adjusts to market conditions with mathematical precision.
  </p>
</IndicatorLayout>