---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'heikin_ashi_candles';
const indicatorName = 'Heikin Ashi Candles';
const description = `Heikin Ashi is a Japanese candlestick charting technique that filters out market noise by using modified price calculations to create smoother candlestick patterns that make trends easier to identify.`;
const parameters = [];  // Heikin Ashi doesn't typically have parameters
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    Heikin Ashi (平均足, meaning "average bar" in Japanese) is a type of price chart that shares some 
    characteristics with standard candlestick charts but uses a modified formula to calculate values. 
    Instead of using actual open, high, low, and close prices, Heikin Ashi uses average prices to 
    create each candle, resulting in a smoother appearance that filters out market noise and makes 
    trends more apparent.
  </p>
  <p>
    The technique was developed to help traders identify trends, potential reversal points, and 
    market strength more easily. By averaging price data, Heikin Ashi candles remove much of the 
    volatility from normal candlestick charts, allowing traders to focus on the overall trend 
    direction rather than getting caught up in minor price fluctuations.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Candle Colors and Patterns</h3>
  <ul>
    <li><strong>Green/White candles with no lower shadow:</strong> Strong uptrend</li>
    <li><strong>Green/White candles with small lower shadow:</strong> Uptrend</li>
    <li><strong>Candles with small body and shadows:</strong> Trend change or consolidation</li>
    <li><strong>Red/Black candles with small upper shadow:</strong> Downtrend</li>
    <li><strong>Red/Black candles with no upper shadow:</strong> Strong downtrend</li>
  </ul>

  <h3>Key Signals</h3>
  <ul>
    <li><strong>Trend Strength:</strong> The absence of shadows on the opposite side of the trend indicates strength</li>
    <li><strong>Trend Reversal:</strong> Doji-like candles (small body) often precede trend changes</li>
    <li><strong>Trend Continuation:</strong> Sequential candles of the same color confirm trend direction</li>
    <li><strong>Support/Resistance:</strong> Heikin Ashi candles respect support and resistance levels</li>
  </ul>

  <h3>Trading Rules</h3>
  <ul>
    <li><strong>Buy Signal:</strong> When candles turn from red to green, especially with no lower shadow</li>
    <li><strong>Sell Signal:</strong> When candles turn from green to red, especially with no upper shadow</li>
    <li><strong>Hold:</strong> Stay in position as long as candles maintain color</li>
    <li><strong>Exit:</strong> Consider exit when doji candles appear after a trend</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>Heikin Ashi candles are calculated using the following formulas:</p>
  <ol>
    <li><strong>HA Close:</strong> <code>(Open + High + Low + Close) / 4</code></li>
    <li><strong>HA Open:</strong> <code>(Previous HA Open + Previous HA Close) / 2</code></li>
    <li><strong>HA High:</strong> <code>Max(High, HA Open, HA Close)</code></li>
    <li><strong>HA Low:</strong> <code>Min(Low, HA Open, HA Close)</code></li>
  </ol>
  <p>
    For the first candle, the HA Open is typically calculated as <code>(Open + Close) / 2</code> 
    since there's no previous Heikin Ashi candle to reference. This recursive calculation creates 
    the smoothing effect that makes Heikin Ashi charts so effective for trend identification.
  </p>

  <h2 id="parameters">Parameters</h2>
  <p>
    Heikin Ashi candles don't have configurable parameters as they use a fixed mathematical formula. 
    The calculation always uses the same averaging method described above. However, traders can apply 
    Heikin Ashi transformation to different timeframes (1-minute, 5-minute, hourly, daily, etc.) to 
    analyze trends at various scales.
  </p>

  <h2 id="returns">Returns & Output</h2>
  <p>The Heikin Ashi transformation returns modified OHLC values:</p>
  <ul>
    <li><strong>HA Open:</strong> Averaged opening price</li>
    <li><strong>HA High:</strong> Highest value among High, HA Open, and HA Close</li>
    <li><strong>HA Low:</strong> Lowest value among Low, HA Open, and HA Close</li>
    <li><strong>HA Close:</strong> Average of all four prices (OHLC)</li>
    <li><strong>Structure:</strong> Array of OHLC objects or separate arrays for each component</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust">
use ta_lib::indicators::heikin_ashi_candles;

// Transform regular candles to Heikin Ashi
let ha_candles = heikin_ashi_candles(&ohlc_data)?;

// Access transformed values
for (i, candle) in ha_candles.iter().enumerate() {
    let is_bullish = candle.close > candle.open;
    let has_no_lower_shadow = (candle.low - candle.open.min(candle.close)).abs() < 0.001;
    
    if is_bullish && has_no_lower_shadow {
        println!("Strong bullish signal at candle {}", i);
    }
}

// Identify trend changes
for i in 1..ha_candles.len() {
    let prev_bullish = ha_candles[i-1].close > ha_candles[i-1].open;
    let curr_bullish = ha_candles[i].close > ha_candles[i].open;
    
    if prev_bullish != curr_bullish {
        println!("Potential trend reversal at candle {}", i);
    }
}
  </code></pre>

  <h3>Python Integration</h3>
  <pre><code class="language-python">
import pandas as pd
import numpy as np
from ta_lib import heikin_ashi_candles

# Calculate Heikin Ashi candles
ha_data = heikin_ashi_candles(df[['open', 'high', 'low', 'close']])
df['ha_open'] = ha_data['open']
df['ha_high'] = ha_data['high']
df['ha_low'] = ha_data['low']
df['ha_close'] = ha_data['close']

# Identify candle types
df['ha_color'] = np.where(df['ha_close'] > df['ha_open'], 'green', 'red')
df['ha_body'] = abs(df['ha_close'] - df['ha_open'])
df['ha_upper_shadow'] = df['ha_high'] - df[['ha_open', 'ha_close']].max(axis=1)
df['ha_lower_shadow'] = df[['ha_open', 'ha_close']].min(axis=1) - df['ha_low']

# Generate signals
df['signal'] = 0
df.loc[(df['ha_color'] == 'green') & (df['ha_lower_shadow'] < 0.01), 'signal'] = 1
df.loc[(df['ha_color'] == 'red') & (df['ha_upper_shadow'] < 0.01), 'signal'] = -1
  </code></pre>

  <h2 id="use-cases">Common Use Cases</h2>
  <h3>1. Trend Trading</h3>
  <p>Use Heikin Ashi for clear trend identification:</p>
  <pre><code class="language-python">
# Enter long when strong bullish candles appear
long_entry = (ha_color == 'green') & (ha_lower_shadow < ha_body * 0.1)

# Stay in position while trend continues
hold_long = ha_color == 'green'

# Exit when color changes or doji appears
exit_long = (ha_color == 'red') | (ha_body < average_body * 0.3)
  </code></pre>

  <h3>2. Swing Trading</h3>
  <p>Identify swing points using Heikin Ashi patterns:</p>
  <pre><code class="language-python">
# Look for trend exhaustion (small bodies after trend)
exhaustion = (ha_body < ha_body.rolling(10).mean() * 0.5)

# Confirm reversal with color change
reversal = exhaustion.shift(1) & (ha_color != ha_color.shift(1))
  </code></pre>

  <h3>3. Multi-Timeframe Analysis</h3>
  <p>Combine different timeframes for confirmation:</p>
  <pre><code class="language-python">
# Daily Heikin Ashi for trend direction
daily_ha = heikin_ashi_candles(daily_data)
daily_trend = 'up' if daily_ha['close'][-1] > daily_ha['open'][-1] else 'down'

# Hourly Heikin Ashi for entry timing
hourly_ha = heikin_ashi_candles(hourly_data)
entry_signal = (daily_trend == 'up') & (hourly_ha['color'] == 'green')
  </code></pre>

  <h2 id="edge-cases">Edge Cases & Errors</h2>
  <h3>Limitations</h3>
  <ul>
    <li><strong>Delayed signals:</strong> Due to averaging, signals may lag actual price reversals</li>
    <li><strong>Gap handling:</strong> Price gaps are smoothed out and may not be visible</li>
    <li><strong>Entry/Exit prices:</strong> HA prices differ from actual market prices</li>
    <li><strong>False continuations:</strong> Strong trends can produce many similar candles before reversal</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Use actual prices (not HA prices) for order placement</li>
    <li>Combine with other indicators for confirmation</li>
    <li>Be aware of the lag in reversal signals</li>
    <li>Use multiple timeframes for better context</li>
    <li>Consider volatility when interpreting shadow sizes</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Nison, S. (2001). <em>Beyond Candlesticks: New Japanese Charting Techniques Revealed</em>. John Wiley & Sons.</li>
    <li>Valcu, D. (2004). "Using The Heikin-Ashi Technique". <em>Technical Analysis of Stocks & Commodities</em>.</li>
    <li>Japanese candlestick charting techniques and modifications</li>
    <li>Comparison of Heikin Ashi with traditional candlestick patterns</li>
  </ul>
</IndicatorLayout>