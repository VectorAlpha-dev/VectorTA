---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'cwma';
const indicatorName = 'Cumulative Weighted Moving Average (CWMA)';
const description = `The Cumulative Weighted Moving Average (CWMA) is an advanced moving average that applies progressively increasing weights to more recent data points. Unlike traditional weighted moving averages that reset weights each period, CWMA accumulates weights over time, creating a highly responsive yet stable trend-following indicator.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 14,
    "min": 2,
    "max": 200,
    "description": "Number of periods for the weighted average calculation"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Cumulative Weighted Moving Average (CWMA) represents an innovative approach to moving average calculation 
    that addresses the limitations of traditional weighted averages. While standard weighted moving averages apply 
    fixed weights that reset with each new period, CWMA accumulates weights over time, creating a unique balance 
    between responsiveness to recent price changes and stability from historical data.
  </p>
  <p>
    This cumulative approach results in a moving average that places increasing emphasis on recent prices while 
    still maintaining a memory of older price movements. The CWMA is particularly effective for identifying 
    sustainable trends and filtering out short-term noise, making it valuable for both trend-following strategies 
    and as a dynamic support/resistance indicator.
  </p>

  <h2>How It Works</h2>
  <p>The CWMA calculation involves cumulative weighting:</p>
  <ol>
    <li><strong>Weight Assignment:</strong> Each price point receives a weight based on its position</li>
    <li><strong>Cumulative Calculation:</strong> Weights accumulate rather than reset each period</li>
    <li><strong>Progressive Emphasis:</strong> Recent prices have exponentially more influence</li>
    <li><strong>Normalization:</strong> Total weights are normalized to produce the average</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200"> For period n:<br/>
      Weight[i] = (n - i + 1)<br/>
      <br/>
      Numerator = Σ(Price[i] × Weight[i]) for i = 0 to n-1<br/>
      Denominator = Σ(Weight[i]) for i = 0 to n-1<br/>
      <br/>
      CWMA = Numerator / Denominator<br/>
      <br/>
      Where:<br/>
      - Recent prices get higher weights<br/>
      - Weights increase linearly with recency<br/>
      - Total weight = n × (n + 1) / 2
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Cumulative Weighting:</strong> Weights accumulate rather than reset</li>
    <li><strong>Progressive Response:</strong> Increasingly sensitive to recent price changes</li>
    <li><strong>Smooth Transitions:</strong> Less prone to whipsaws than simple weighted averages</li>
    <li><strong>Trend Persistence:</strong> Better at maintaining trend direction</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>CWMA Behavior</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Trend Identification:</h4> <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Rising CWMA:</strong> Uptrend with accelerating momentum</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Falling CWMA:</strong> Downtrend with accelerating momentum</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Flat CWMA:</strong> Consolidation or trend exhaustion</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> CWMA Slope Change:</strong> Early trend reversal signal</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Trading Signals:</h4> <ul class="list-disc list-inside text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Price Above CWMA:</strong> Bullish bias, potential support</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Price Below CWMA:</strong> Bearish bias, potential resistance</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Price Crosses CWMA:</strong> Potential trend change</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> CWMA Acceleration:</strong> Trend strengthening</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Trend Following:</strong>
      <ul>
        <li>Enter long when price crosses above CWMA with rising CWMA</li>
        <li>Enter short when price crosses below CWMA with falling CWMA</li>
        <li>Exit when price crosses back through CWMA</li>
      </ul>
    </li>
    <li><strong>Dynamic Support/Resistance:</strong>
      <ul>
        <li>Use CWMA as trailing stop in trends</li>
        <li>Buy pullbacks to rising CWMA</li>
        <li>Sell rallies to falling CWMA</li>
      </ul>
    </li>
    <li><strong>Momentum Confirmation:</strong>
      <ul>
        <li>Strong trend: Price stays far from CWMA</li>
        <li>Weakening trend: Price converges toward CWMA</li>
        <li>Use CWMA slope for momentum measurement</li>
      </ul>
    </li>
    <li><strong>Multiple Period Strategy:</strong> Use fast and slow CWMA for crossover signals</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>Adaptive Periods:</strong> Adjust period based on market volatility</li>
    <li><strong>Distance Analysis:</strong> Measure price distance from CWMA for extremes</li>
    <li><strong>Angle Measurement:</strong> Quantify CWMA slope for trend strength</li>
    <li><strong>Envelope Trading:</strong> Add percentage bands around CWMA</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>More responsive than SMA while smoother than EMA</li>
    <li>Excellent trend-following characteristics</li>
    <li>Natural acceleration/deceleration detection</li>
    <li>Works well as dynamic support/resistance</li>
    <li>Reduces false signals in choppy markets</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Still lags during rapid reversals</li>
    <li>May overshoot in volatile markets</li>
    <li>Requires sufficient data for stability</li>
    <li>Less effective in strong ranging markets</li>
    <li>Computational complexity higher than simple averages</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>CWMA works effectively when combined with:</p>
  <ul>
    <li><strong>RSI or MACD:</strong> CWMA for trend, oscillators for timing</li>
    <li><strong>Bollinger Bands:</strong> Use CWMA as centerline for unique perspective</li>
    <li><strong>Volume Indicators:</strong> Confirm CWMA signals with volume</li>
    <li><strong>ATR:</strong> Set stops based on CWMA ± ATR multiple</li>
    <li><strong>Fibonacci Levels:</strong> Combine with CWMA for confluence zones</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical foundation of CWMA lies in its triangular weighting scheme. Unlike exponential weights that 
    decay geometrically, CWMA uses arithmetic progression where the most recent price has weight n, the second 
    most recent has weight n-1, and so on. This creates a triangular distribution of weights that accumulates 
    to n(n+1)/2, providing a natural normalization factor.
  </p>
  <p>
    This cumulative approach means that as we move through time, the influence of older prices diminishes not 
    just relatively but absolutely, creating a moving average that naturally adapts to changing market conditions. 
    The linear weight progression ensures smooth transitions while maintaining sufficient responsiveness to capture 
    trend changes effectively.
  </p>

</IndicatorLayout>
