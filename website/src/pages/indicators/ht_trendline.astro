---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'ht_trendline';
const indicatorName = 'Hilbert Transform - Instantaneous Trendline';
const description = `The Hilbert Transform Instantaneous Trendline is a smooth, adaptive moving average that uses the dominant cycle period to create a trend-following line with minimal lag, automatically adjusting to market conditions without whipsaws.`;
const parameters: Array<{
  name: string;
  type: 'number' | 'boolean';
  default: any;
  min?: number;
  max?: number;
  description?: string;
}> = [];  // Hilbert Transform indicators are typically parameter-free
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    The Hilbert Transform - Instantaneous Trendline, developed by John Ehlers, represents a 
    revolutionary approach to creating adaptive moving averages. Unlike traditional moving averages 
    that use fixed periods, the Instantaneous Trendline automatically adjusts its smoothing based 
    on the measured dominant cycle period in the market. This creates a trend-following indicator 
    that remains smooth during trends but becomes more responsive during cycle mode.
  </p>
  <p>
    The "instantaneous" aspect refers to the indicator's ability to adapt in real-time to changing 
    market conditions. When the dominant cycle period is long (trending market), the trendline 
    becomes smoother with more lag. When the cycle period is short (cycling market), it becomes 
    more responsive. This adaptive behavior makes it superior to fixed-period moving averages for 
    both trend following and cycle identification.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Trend Identification</h3>
  <ul>
    <li><strong>Price above trendline:</strong> Bullish trend bias</li>
    <li><strong>Price below trendline:</strong> Bearish trend bias</li>
    <li><strong>Slope direction:</strong> Primary trend direction</li>
    <li><strong>Slope steepness:</strong> Trend strength indicator</li>
  </ul>

  <h3>Trading Signals</h3>
  <ul>
    <li><strong>Crossover signals:</strong> Price crossing trendline suggests trend change</li>
    <li><strong>Trendline turns:</strong> Changes in trendline direction signal momentum shifts</li>
    <li><strong>Support/Resistance:</strong> Trendline acts as dynamic support in uptrends</li>
    <li><strong>Pullback entries:</strong> Buy/sell when price touches trendline in trends</li>
  </ul>

  <h3>Key Characteristics</h3>
  <ul>
    <li><strong>Adaptive smoothing:</strong> Automatically adjusts to market conditions</li>
    <li><strong>Minimal whipsaws:</strong> Smooth during trends, responsive during cycles</li>
    <li><strong>No lag in cycles:</strong> Becomes more responsive when cycling detected</li>
    <li><strong>Trend persistence:</strong> Maintains direction during strong trends</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>The Instantaneous Trendline calculation involves:</p>
  <ol>
    <li><strong>Measure Dominant Cycle Period:</strong> Using Hilbert Transform</li>
    <li><strong>Calculate Adaptive Alpha:</strong> <code>α = 2 / (Period + 1)</code></li>
    <li><strong>Apply Adaptive EMA:</strong> <code>IT[i] = α * Price[i] + (1 - α) * IT[i-1]</code></li>
    <li><strong>Smooth the Alpha:</strong> Prevent abrupt changes in smoothing factor</li>
    <li><strong>Apply Median Filter:</strong> Remove outliers from cycle period measurement</li>
    <li><strong>Secondary Smoothing:</strong> Additional 3-bar WMA for stability</li>
  </ol>
  <p>
    The key innovation is using the instantaneous cycle period to continuously adjust the smoothing 
    factor (alpha). This creates a moving average that knows when to be smooth (trending markets) 
    and when to be responsive (cycling markets), eliminating the need for manual period optimization.
  </p>

  <h2 id="parameters">Parameters</h2>
  <p>
    The Hilbert Transform Instantaneous Trendline has no user-adjustable parameters. The indicator 
    automatically determines the optimal smoothing based on the dominant cycle period measured by 
    the Hilbert Transform. This self-optimizing design ensures the trendline always uses the most 
    appropriate smoothing for current market conditions.
  </p>
  <p>
    Internal adaptive mechanisms:
  </p>
  <ul>
    <li><strong>Period range:</strong> Typically adapts between 10-50 bar equivalent</li>
    <li><strong>Alpha bounds:</strong> Smoothing factor limited to prevent instability</li>
    <li><strong>Median filter:</strong> 5-bar median of measured periods</li>
    <li><strong>Output smoothing:</strong> 3-bar WMA on final trendline</li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The indicator returns an adaptive trendline:</p>
  <ul>
    <li><strong>Type:</strong> Array of floating-point numbers</li>
    <li><strong>Values:</strong> Smoothed price levels following the trend</li>
    <li><strong>Characteristics:</strong> Smooth in trends, responsive in cycles</li>
    <li><strong>Lag:</strong> Variable, automatically minimized based on conditions</li>
    <li><strong>Initial values:</strong> Requires ~50 bars for Hilbert Transform</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. Adaptive Trend Following</h3> <p>Trade with the trend using adaptive signals:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. Mean Reversion from Trendline</h3> <p>Trade reversions to the adaptive trendline:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. Multi-Timeframe Trend Analysis</h3> <p>Combine trendlines from multiple timeframes:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>Initialization period:</strong> Requires ~50 bars for accurate adaptation</li>
    <li><strong>Extreme volatility:</strong> May become too responsive in very volatile conditions</li>
    <li><strong>Cycle measurement errors:</strong> Poor cycle detection affects smoothing</li>
    <li><strong>Transition periods:</strong> May lag during trend-to-cycle transitions</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Allow adequate warmup period before trading signals</li>
    <li>Combine with HT_TRENDMODE for market regime confirmation</li>
    <li>Use volatility-adjusted bands around trendline</li>
    <li>Monitor effective smoothing period for insights</li>
    <li>Consider price action confirmation at trendline</li>
    <li>Be cautious during major news events</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Ehlers, J. F. (2001). <em>Rocket Science for Traders</em>. John Wiley & Sons.</li>
    <li>Ehlers, J. F. (2013). <em>Cycle Analytics for Traders</em>. John Wiley & Sons.</li>
    <li>Adaptive moving average techniques and theory</li>
    <li>Comparison with KAMA, VIDYA, and other adaptive averages</li>
  </ul>
</IndicatorLayout>
