---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'ehlers_itrend';
const indicatorName = 'Ehlers Instantaneous Trend (iTrend)';
const description = `The Ehlers Instantaneous Trend (iTrend) is a revolutionary adaptive moving average developed by John Ehlers that uses advanced digital signal processing to create a trend line with minimal lag. By employing complex mathematical techniques including Hilbert Transform concepts, iTrend adapts its smoothing based on market cycles, providing traders with a responsive yet stable trend indicator.`;
const parameters = [
  {
    "name": "alpha",
    "type": "number",
    "default": 0.07,
    "min": 0.01,
    "max": 0.20,
    "description": "Smoothing factor for the iTrend calculation"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Ehlers Instantaneous Trend (iTrend) represents a breakthrough in adaptive moving average technology, developed 
    by John Ehlers using advanced digital signal processing concepts. Unlike traditional moving averages that apply 
    fixed weights, iTrend dynamically adjusts its smoothing based on the dominant market cycle, creating a trend line 
    that remains smooth during stable trends yet responds quickly to genuine trend changes. This unique combination 
    makes iTrend one of the most sophisticated trend-following tools available.
  </p>
  <p>
    What sets iTrend apart is its use of concepts from the Hilbert Transform to identify the dominant cycle period 
    in real-time. By continuously measuring market cycles and adjusting its parameters accordingly, iTrend achieves 
    what fixed-parameter indicators cannot: optimal smoothing for current market conditions. During trending periods, 
    it provides a stable line that keeps traders in position. During transitions, it responds faster than traditional 
    moving averages, helping traders capture new trends early while avoiding whipsaws.
  </p>

  <h2>How It Works</h2>
  <p>iTrend employs sophisticated signal processing techniques:</p>
  <ol>
    <li><strong>Initialize with Price:</strong> Start with current price as initial value</li>
    <li><strong>Calculate Instantaneous Period:</strong> Measure dominant cycle (typically 10-40 bars)</li>
    <li><strong>Derive Alpha:</strong> Convert period to optimal smoothing factor</li>
    <li><strong>Apply Adaptive Filter:</strong> Use variable alpha for exponential smoothing</li>
    <li><strong>Output Smooth Trend:</strong> Result adapts to market conditions</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200"> Simplified iTrend Calculation:<br/>
      <br/>
      Initial: iTrend[0] = Price[0]<br/>
      <br/>
      For each bar:<br/>
      Price = (High + Low) / 2<br/>
      <br/>
      iTrend = (α - α²/4) × Price + <br/>
               0.5 × α² × Price[1] - <br/>
               (α - 0.75 × α²) × Price[2] + <br/>
               2 × (1 - α) × iTrend[1] - <br/>
               (1 - α)² × iTrend[2]<br/>
      <br/>
      Where α (alpha) is the smoothing factor:<br/>
      Default α = 0.07 (adjustable parameter)<br/>
      <br/>
      In full implementation, α adapts based on:<br/>
      Measured dominant cycle period<br/>
      Market volatility conditions<br/>
      Price acceleration/deceleration
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Adaptive Smoothing:</strong> Automatically adjusts to market cycles</li>
    <li><strong>Minimal Lag:</strong> Responds quickly to genuine trend changes</li>
    <li><strong>Noise Reduction:</strong> Filters out market noise effectively</li>
    <li><strong>Cycle Awareness:</strong> Based on dominant cycle measurement</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>iTrend Analysis</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Trend Direction:</h4> <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Rising iTrend:</strong> Uptrend in progress</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Falling iTrend:</strong> Downtrend in progress</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Flat iTrend:</strong> Consolidation or ranging market</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> iTrend Slope Change:</strong> Potential trend reversal</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Key Signals:</h4> <ul class="list-disc list-inside text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Price Cross Above iTrend:</strong> Bullish momentum shift</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Price Cross Below iTrend:</strong> Bearish momentum shift</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> iTrend Acceleration:</strong> Trend strengthening</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> iTrend Flattening:</strong> Trend weakening or ending</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Trend Following:</strong>
      <ul>
        <li>Buy when price crosses above rising iTrend</li>
        <li>Sell when price crosses below falling iTrend</li>
        <li>Use iTrend as dynamic stop loss</li>
        <li>Stay in position while price remains on correct side</li>
      </ul>
    </li>
    <li><strong>Pullback Trading:</strong>
      <ul>
        <li>Buy dips to rising iTrend in uptrends</li>
        <li>Sell rallies to falling iTrend in downtrends</li>
        <li>Enter on touch with momentum confirmation</li>
        <li>Place stops beyond iTrend line</li>
      </ul>
    </li>
    <li><strong>Breakout Confirmation:</strong>
      <ul>
        <li>Confirm breakouts when iTrend turns in breakout direction</li>
        <li>False breakouts show iTrend remaining flat or contrary</li>
        <li>Wait for iTrend alignment before entering</li>
        <li>Exit if iTrend fails to confirm within 3-5 bars</li>
      </ul>
    </li>
    <li><strong>Multiple iTrend:</strong> Use different alpha values for entry/exit</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>iTrend Bands:</strong> Add percentage or ATR bands around iTrend</li>
    <li><strong>iTrend Slope:</strong> Measure angle for trend strength</li>
    <li><strong>Composite iTrend:</strong> Combine multiple timeframe iTrends</li>
    <li><strong>Cycle-Adaptive Alpha:</strong> Vary alpha based on measured cycles</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Adapts automatically to market conditions</li>
    <li>Minimal lag compared to traditional MAs</li>
    <li>Excellent noise filtering capabilities</li>
    <li>Works well in trending and cycling markets</li>
    <li>Based on solid DSP principles</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Complex calculation requires understanding</li>
    <li>May oversmooth in very volatile conditions</li>
    <li>Alpha parameter still needs optimization</li>
    <li>Full adaptive version requires cycle measurement</li>
    <li>Can lag during sharp V-reversals</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>iTrend pairs exceptionally well with:</p>
  <ul>
    <li><strong>Ehlers Indicators:</strong> Combine with CyberCycle, MAMA</li>
    <li><strong>Momentum Oscillators:</strong> Use RSI/MACD for timing</li>
    <li><strong>Volatility Bands:</strong> Add Bollinger or Keltner Bands</li>
    <li><strong>Market Structure:</strong> Trade iTrend signals at key levels</li>
    <li><strong>Volume:</strong> Confirm iTrend signals with volume analysis</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical foundation of iTrend lies in digital signal processing theory, specifically in the design of 
    adaptive filters. The core equation implements a second-order filter that combines elements of both FIR (Finite 
    Impulse Response) and IIR (Infinite Impulse Response) designs. The coefficients are carefully chosen to provide 
    zero lag at the dominant cycle frequency while maintaining stability across all market conditions.
  </p>
  <p>
    The genius of Ehlers' approach is recognizing that financial markets exhibit quasi-cyclical behavior, and that 
    optimal filtering requires adapting to these cycles. The default alpha of 0.07 corresponds roughly to a 20-period 
    moving average, but the true power comes when alpha is adjusted based on measured market cycles. This creates a 
    moving average that "thinks" - speeding up during transitions and slowing down during trends, achieving what 
    traders have always wanted: a smooth line that doesn't lag at turns.
  </p>
</IndicatorLayout>
