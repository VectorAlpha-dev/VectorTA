---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'kdj';
const indicatorName = 'KDJ Indicator';
const description = `The KDJ Indicator is a popular momentum oscillator in Asian markets that extends the Stochastic Oscillator by adding a third line (J) which emphasizes short-term momentum, providing earlier signals for overbought/oversold conditions and potential reversals.`;
const parameters = [
  {
    "name": "k_period",
    "type": "number",
    "default": 9,
    "min": 2,
    "max": 200,
    "description": "%K period (raw stochastic)"
  },
  {
    "name": "d_period",
    "type": "number",
    "default": 3,
    "min": 1,
    "max": 200,
    "description": "%D period (signal line)"
  },
  {
    "name": "j_period",
    "type": "number",
    "default": 3,
    "min": 1,
    "max": 50,
    "description": "%J smoothing period"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    The KDJ Indicator is a sophisticated momentum oscillator particularly popular in Chinese and 
    Asian financial markets. It builds upon the traditional Stochastic Oscillator by adding a 
    third line - the J line - which amplifies the divergence between the K and D lines to provide 
    earlier and more sensitive trading signals.
  </p>
  <p>
    The J line is calculated as J = 3K - 2D, which mathematically emphasizes the momentum and 
    divergence of the K line from its signal line D. This creates a leading indicator that can 
    identify overbought/oversold conditions and potential reversals before they appear on 
    traditional stochastic indicators. The KDJ is particularly effective in volatile markets 
    where early signal detection is valuable.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Indicator Components</h3>
  <ul>
    <li><strong>K Line (Blue):</strong> The fast stochastic line, showing raw momentum</li>
    <li><strong>D Line (Red):</strong> The signal line, a moving average of K</li>
    <li><strong>J Line (Green):</strong> The emphasis line, calculated as 3K - 2D</li>
    <li><strong>Range:</strong> K and D range 0-100, J can exceed these bounds</li>
  </ul>

  <h3>Trading Signals</h3>
  <ul>
    <li><strong>J  &gt; 100:</strong> Extreme overbought condition, potential reversal</li>
    <li><strong>J &lt; 0:</strong> Extreme oversold condition, potential bounce</li>
    <li><strong>K crosses above D:</strong> Bullish signal, especially below 20</li>
    <li><strong>K crosses below D:</strong> Bearish signal, especially above 80</li>
    <li><strong>J line reversals:</strong> Early warning of momentum shifts</li>
  </ul>

  <h3>Market Conditions</h3>
  <ul>
    <li><strong>Trending markets:</strong> Use J line extremes for counter-trend entries</li>
    <li><strong>Ranging markets:</strong> Trade crossovers at oversold/overbought levels</li>
    <li><strong>J line divergence:</strong> When J diverges from price, expect reversals</li>
    <li><strong>Triple confirmation:</strong> All three lines in agreement = strong signal</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>The KDJ calculation follows these steps:</p>
  <ol>
    <li><strong>Calculate %K (Raw Stochastic):</strong>
      <ul>
        <li>RSV = (Close - Lowest Low) / (Highest High - Lowest Low) × 100</li>
        <li>%K = RSV (or smoothed RSV in some implementations)</li>
      </ul>
    </li>
    <li><strong>Calculate %D (Signal Line):</strong>
      <ul>
        <li>%D = SMA(%K, d_period)</li>
        <li>Typically a 3-period simple moving average of %K</li>
      </ul>
    </li>
    <li><strong>Calculate %J (Emphasis Line):</strong>
      <ul>
        <li>%J = 3 × %K - 2 × %D</li>
        <li>This amplifies the divergence between K and D</li>
      </ul>
    </li>
    <li><strong>Optional J Smoothing:</strong>
      <ul>
        <li>Some implementations apply additional smoothing to J</li>
        <li>J_smooth = SMA(%J, j_period)</li>
      </ul>
    </li>
  </ol>
  <p>
    The mathematical relationship J = 3K - 2D ensures that when K &gt; D (bullish momentum), 
    J will be even higher, providing an early signal. Conversely, when K &lt; D (bearish momentum), 
    J will be even lower. This amplification makes J particularly sensitive to momentum changes.
  </p>

  <h2 id="parameters">Parameters</h2>
  <ul>
    <li>
      <strong>K Period (default: 9):</strong> The lookback period for calculating the raw stochastic 
      %K. Common values are 9, 14, or 21. Shorter periods (5-9) provide more sensitive signals but 
      may generate more false signals. Longer periods (14-21) are smoother but may lag. The 
      traditional value of 9 works well for most markets.
    </li>
    <li>
      <strong>D Period (default: 3):</strong> The smoothing period for the %D signal line. This is 
      typically kept at 3 for responsive signals. Increasing to 5-6 reduces whipsaws but adds lag. 
      The relationship between K and D periods affects crossover frequency.
    </li>
    <li>
      <strong>J Period (default: 3):</strong> Optional smoothing applied to the J line. Some traders 
      prefer raw J values (period = 1) for earliest signals, while others smooth with 3-5 periods 
      to reduce noise. This parameter may not be present in all implementations.
    </li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The indicator returns three arrays representing the KDJ lines:</p>
  <ul>
    <li><strong>K values:</strong> Array of %K stochastic values (0-100)</li>
    <li><strong>D values:</strong> Array of %D signal line values (0-100)</li>
    <li><strong>J values:</strong> Array of %J emphasis values (can exceed 0-100)</li>
    <li><strong>Initial values:</strong> First k_period values will be null/undefined</li>
    <li><strong>J line range:</strong> Typically -20 to 120, but can extend further</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. J-Line Extreme Trading</h3> <p>Trading based on J-line extremes:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. KDJ Crossover System</h3> <p>Trading crossovers with zone confirmation:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. KDJ Divergence Trading</h3> <p>Trading divergences between price and J-line:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>J-line extremes:</strong> J can reach values far beyond 0-100 range</li>
    <li><strong>Whipsaws:</strong> Frequent crossovers in choppy markets</li>
    <li><strong>Lag in trends:</strong> KDJ can remain overbought/oversold in strong trends</li>
    <li><strong>False signals:</strong> J-line sensitivity can generate premature signals</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Use J extremes (beyond 0/100) for high-probability reversal trades</li>
    <li>Confirm crossovers with zone position (oversold/overbought)</li>
    <li>Monitor J-line momentum for early trend change detection</li>
    <li>Combine with trend indicators to avoid counter-trend trades</li>
    <li>Use wider stops when J shows extreme readings</li>
    <li>Consider market volatility when interpreting signals</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Technical Analysis in Asian Markets - KDJ Indicator Applications</li>
    <li>Stochastic Oscillator variations and enhancements</li>
    <li>Momentum indicators in volatile markets</li>
    <li>Comparative studies: KDJ vs traditional Stochastic indicators</li>
  </ul>
</IndicatorLayout>
