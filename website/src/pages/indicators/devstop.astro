---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'devstop';
const indicatorName = 'Deviation Stop (DevStop)';
const description = `The Deviation Stop (DevStop) is an adaptive trailing stop indicator developed by Cynthia Kase that uses true range and standard deviation to create dynamic stop levels. Unlike fixed percentage stops, DevStop adjusts to market volatility, tightening in calm markets and widening during volatile periods, providing optimal protection while allowing trades room to breathe.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 20,
    "min": 10,
    "max": 50,
    "description": "Lookback period for volatility calculation"
  },
  {
    "name": "factor",
    "type": "number",
    "default": 2.2,
    "min": 1.0,
    "max": 4.0,
    "description": "Standard deviation multiplier for stop distance"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Deviation Stop (DevStop), created by renowned technical analyst Cynthia Kase, represents a breakthrough in 
    adaptive stop-loss technology. By combining true range volatility with statistical standard deviation, DevStop 
    creates intelligent trailing stops that automatically adjust to market conditions. This solves one of trading's 
    biggest challenges: setting stops tight enough to protect capital but wide enough to avoid premature exits.
  </p>
  <p>
    What makes DevStop revolutionary is its dual-volatility approach. It measures both the typical daily range (using 
    true range) and the variability of that range (using standard deviation), creating stops that respond to both 
    the magnitude and consistency of price movements. This sophisticated approach means stops widen during news events 
    or volatile conditions and tighten during quiet trends, maximizing both protection and profit potential.
  </p>

  <h2>How It Works</h2>
  <p>DevStop uses a multi-step calculation combining volatility measures:</p>
  <ol>
    <li><strong>Calculate True Range:</strong> Measure daily price movement including gaps</li>
    <li><strong>Compute Average True Range:</strong> Smooth the true range over the period</li>
    <li><strong>Calculate Standard Deviation:</strong> Measure variability of true range</li>
    <li><strong>Combine Measures:</strong> ATR + (StdDev × Factor) = Stop distance</li>
    <li><strong>Apply Trailing Logic:</strong> Ratchet stops up in uptrends, down in downtrends</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200"> True Range = Max(High - Low, |High - Close[1]|, |Low - Close[1]|)<br/>
      <br/>
      ATR = Average(True Range, Period)<br/>
      <br/>
      StdDev_TR = StandardDeviation(True Range, Period)<br/>
      <br/>
      Stop Distance = ATR + (Factor × StdDev_TR)<br/>
      <br/>
      For Long Positions:<br/>
      DevStop = High - Stop Distance<br/>
      Final Stop = Max(DevStop, Previous Stop)<br/>
      <br/>
      For Short Positions:<br/>
      DevStop = Low + Stop Distance<br/>
      Final Stop = Min(DevStop, Previous Stop)
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Volatility Adaptive:</strong> Automatically adjusts to market conditions</li>
    <li><strong>Dual Measurement:</strong> Combines ATR and standard deviation</li>
    <li><strong>Trailing Mechanism:</strong> Only moves in favor of position</li>
    <li><strong>Statistical Foundation:</strong> Based on probability theory</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>Stop Management</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Stop Behavior:</h4> <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Widening Stops:</strong> Market becoming more volatile</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Tightening Stops:</strong> Market calming, trend maturing</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Flat Stops:</strong> Price consolidating or retracing</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Stop Hit:</strong> Exit signal, trend potentially ending</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100"> Trading Applications:</h4> <ul class="list-disc list-inside text-gray-700 dark:text-gray-300"> <li><strong class="text-gray-900 dark:text-gray-100"> Entry Confirmation:</strong> Enter when price clears DevStop</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Position Management:</strong> Use as trailing stop</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Trend Strength:</strong> Distance from stop indicates strength</li>
      <li><strong class="text-gray-900 dark:text-gray-100"> Re-entry:</strong> Re-enter if price reclaims DevStop</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Trend Following System:</strong>
      <ul>
        <li>Enter long when price crosses above DevStop</li>
        <li>Trail stop using DevStop throughout trend</li>
        <li>Exit when price closes below DevStop</li>
      </ul>
    </li>
    <li><strong>Volatility Breakout:</strong>
      <ul>
        <li>Monitor for DevStop compression (low volatility)</li>
        <li>Enter on breakout with DevStop as initial stop</li>
        <li>Trail position with DevStop</li>
      </ul>
    </li>
    <li><strong>Multiple Time Frame:</strong>
      <ul>
        <li>Use higher timeframe DevStop for position stops</li>
        <li>Use lower timeframe for entry timing</li>
        <li>Combine for optimal risk management</li>
      </ul>
    </li>
    <li><strong>Factor Adjustment:</strong> Increase factor in volatile markets, decrease in calm</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>Dynamic Factor:</strong> Adjust factor based on market regime</li>
    <li><strong>Profit Protection:</strong> Tighten factor after significant gains</li>
    <li><strong>Pyramiding:</strong> Add positions when price extends from DevStop</li>
    <li><strong>Options Strategy:</strong> Use DevStop levels for strike selection</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Adapts automatically to volatility changes</li>
    <li>Provides optimal stop placement</li>
    <li>Reduces whipsaw in volatile markets</li>
    <li>Works across all markets and timeframes</li>
    <li>Statistically sound methodology</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Can give back profits in sharp reversals</li>
    <li>Requires trending markets for best results</li>
    <li>May be too wide for short-term traders</li>
    <li>Complex calculation compared to fixed stops</li>
    <li>Historical volatility may not predict future</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>DevStop works excellently with:</p>
  <ul>
    <li><strong>Trend Indicators:</strong> Use MA or ADX for direction, DevStop for risk</li>
    <li><strong>Momentum Oscillators:</strong> Time entries with RSI, manage with DevStop</li>
    <li><strong>Support/Resistance:</strong> Combine with horizontal levels</li>
    <li><strong>Pattern Recognition:</strong> Use DevStop to confirm pattern breaks</li>
    <li><strong>Volume Analysis:</strong> Confirm DevStop signals with volume</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical elegance of DevStop lies in its combination of two complementary volatility measures. Average 
    True Range captures the typical price movement, while standard deviation of true range captures the variability 
    of that movement. This dual approach means the indicator responds to both sustained volatility increases (through 
    ATR) and volatility spikes (through standard deviation).
  </p>
  <p>
    The factor parameter essentially determines the statistical confidence level of the stop. A factor of 2.2 roughly 
    corresponds to a 98% confidence level in a normal distribution, meaning price should only hit the stop about 2% 
    of the time in normal market conditions. This statistical foundation gives traders a mathematical edge in stop 
    placement, moving beyond arbitrary percentage or point-based stops to a system grounded in market dynamics.
  </p>

</IndicatorLayout>
