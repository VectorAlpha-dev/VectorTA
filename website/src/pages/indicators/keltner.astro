---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'keltner';
const indicatorName = 'Keltner Channels';
const description = `Keltner Channels are volatility-based envelope indicators that create dynamic bands around an exponential moving average using Average True Range (ATR), helping identify overbought/oversold conditions, trend direction, and potential breakout opportunities.`;
const parameters = [
  {
    "name": "ema_period",
    "type": "number",
    "default": 20,
    "min": 5,
    "max": 200,
    "description": "EMA period for center line"
  },
  {
    "name": "atr_period",
    "type": "number",
    "default": 10,
    "min": 2,
    "max": 100,
    "description": "ATR period for volatility"
  },
  {
    "name": "multiplier",
    "type": "number",
    "default": 2.0,
    "min": 0.5,
    "max": 5.0,
    "description": "ATR multiplier for band width"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    Keltner Channels, developed by Chester Keltner and later modified by Linda Raschke, are 
    volatility-based envelope indicators that help traders identify trend direction, overbought/oversold 
    conditions, and potential breakout opportunities. The channels consist of an exponential moving 
    average (EMA) centerline with upper and lower bands set at a multiple of the Average True Range (ATR) 
    above and below the centerline.
  </p>
  <p>
    Unlike Bollinger Bands which use standard deviation, Keltner Channels use ATR for volatility 
    measurement, making them smoother and less prone to whipsaws. The channels expand and contract 
    based on market volatility, providing a dynamic framework for identifying trading opportunities. 
    Keltner Channels are particularly effective for trend-following strategies and can be used to 
    identify strong trends when prices consistently trade near or outside the bands.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Channel Components</h3>
  <ul>
    <li><strong>Center Line (EMA):</strong> The baseline showing trend direction</li>
    <li><strong>Upper Channel:</strong> EMA + (ATR × multiplier)</li>
    <li><strong>Lower Channel:</strong> EMA - (ATR × multiplier)</li>
    <li><strong>Channel Width:</strong> Reflects market volatility</li>
  </ul>

  <h3>Trading Signals</h3>
  <ul>
    <li><strong>Trend identification:</strong> Price above/below center line indicates trend</li>
    <li><strong>Channel breaks:</strong> Closes outside channels signal strong momentum</li>
    <li><strong>Mean reversion:</strong> Price returns to center line from extremes</li>
    <li><strong>Squeeze:</strong> Narrow channels indicate low volatility, potential breakout</li>
    <li><strong>Walk the bands:</strong> Strong trends "walk" along upper/lower channel</li>
  </ul>

  <h3>Market Conditions</h3>
  <ul>
    <li><strong>Trending markets:</strong> Price hugs one channel, uses other as stop</li>
    <li><strong>Ranging markets:</strong> Price oscillates between channels</li>
    <li><strong>Breakouts:</strong> Channel breaks with expanding width confirm moves</li>
    <li><strong>Consolidation:</strong> Narrowing channels indicate compression</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>Keltner Channels calculation involves three steps:</p>
  <ol>
    <li><strong>Calculate Center Line:</strong>
      <ul>
        <li>Center Line = EMA(Close, ema_period)</li>
        <li>Typically using 20-period EMA</li>
      </ul>
    </li>
    <li><strong>Calculate Average True Range:</strong>
      <ul>
        <li>True Range = max(High-Low, abs(High-Previous Close), abs(Low-Previous Close))</li>
        <li>ATR = SMA(True Range, atr_period)</li>
      </ul>
    </li>
    <li><strong>Calculate Channel Bands:</strong>
      <ul>
        <li>Upper Channel = Center Line + (ATR × multiplier)</li>
        <li>Lower Channel = Center Line - (ATR × multiplier)</li>
      </ul>
    </li>
  </ol>
  <p>
    The original Keltner Channels used (High+Low+Close)/3 as the center line and (High-Low) for 
    volatility. The modern version using EMA and ATR, popularized by Linda Raschke, provides 
    better trend identification and more consistent volatility measurement across different market 
    conditions.
  </p>

  <h2 id="parameters">Parameters</h2>
  <ul>
    <li>
      <strong>EMA Period (default: 20):</strong> The period for the exponential moving average 
      center line. Common values are 10 (short-term), 20 (standard), and 50 (long-term). Shorter 
      periods make channels more responsive but increase whipsaws. Longer periods create smoother 
      channels better suited for position trading.
    </li>
    <li>
      <strong>ATR Period (default: 10):</strong> The period for calculating Average True Range. 
      Typically set to half the EMA period or 10 bars. Shorter ATR periods make bands more 
      responsive to volatility changes, while longer periods create more stable channel width. 
      Most traders use 10 regardless of EMA period.
    </li>
    <li>
      <strong>Multiplier (default: 2.0):</strong> The number of ATRs to add/subtract from the 
      center line. Common values are 1.5 (tight), 2.0 (standard), and 2.5-3.0 (wide). Lower 
      multipliers create more signals but more false breakouts. Higher multipliers reduce false 
      signals but may miss early moves.
    </li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The indicator returns three arrays representing the channel lines:</p>
  <ul>
    <li><strong>Upper Band:</strong> Array of upper channel values</li>
    <li><strong>Middle Band:</strong> Array of EMA center line values</li>
    <li><strong>Lower Band:</strong> Array of lower channel values</li>
    <li><strong>Initial values:</strong> First max(ema_period, atr_period) values may be unstable</li>
    <li><strong>Band relationship:</strong> Upper and lower equidistant from middle</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. Trend Following Strategy</h3> <p>Trading with the trend using channel breaks:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. Mean Reversion Strategy</h3> <p>Trading returns to the middle band:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. Squeeze Breakout Strategy</h3> <p>Trading volatility expansion after squeeze:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>Whipsaws:</strong> Frequent channel touches in choppy markets</li>
    <li><strong>Lag:</strong> EMA-based channels lag during sharp moves</li>
    <li><strong>Parameter sensitivity:</strong> Wrong multiplier creates too many/few signals</li>
    <li><strong>Gap risk:</strong> Gaps can bypass channel levels entirely</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Use ATR period of 10 regardless of EMA period for consistency</li>
    <li>Adjust multiplier based on market volatility and timeframe</li>
    <li>Confirm breakouts with volume or momentum indicators</li>
    <li>Use channel middle as trailing stop in strong trends</li>
    <li>Combine with squeeze indicators for volatility setups</li>
    <li>Monitor channel width for market regime changes</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Keltner, C. (1960). "How to Make Money in Commodities"</li>
    <li>Raschke, L. B. & Connors, L. A. (1995). "Street Smarts: High Probability Short-Term Trading Strategies"</li>
    <li>Comparison of envelope indicators: Keltner vs Bollinger Bands vs Donchian</li>
    <li>ATR-based volatility bands in systematic trading</li>
  </ul>
</IndicatorLayout>
