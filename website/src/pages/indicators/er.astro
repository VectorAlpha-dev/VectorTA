---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'er';
const indicatorName = 'Efficiency Ratio (ER)';
const description = `The Efficiency Ratio (ER), developed by Perry Kaufman, measures the directional movement of price relative to the total movement, quantifying how efficiently price moves from point A to point B. This ratio forms the adaptive component of KAMA and helps distinguish trending markets from choppy ones, making it invaluable for adjusting trading strategies to market conditions.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 10,
    "min": 5,
    "max": 50,
    "description": "Lookback period for efficiency calculation"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Efficiency Ratio (ER), created by Perry Kaufman, provides a mathematically elegant solution to one of 
    trading's fundamental challenges: distinguishing between trending and ranging markets. By comparing the net price 
    change (direction) to the sum of all individual price movements (volatility), ER quantifies how directly price 
    moves toward its destination. An efficiency of 1.0 indicates perfectly directional movement, while values near 
    zero suggest choppy, directionless markets.
  </p>
  <p>
    What makes ER particularly valuable is its ability to adapt to changing market conditions in real-time. When 
    markets trend strongly, ER rises, signaling that trend-following strategies are likely to succeed. When markets 
    enter choppy consolidations, ER falls, warning traders to reduce position sizes or switch to range-trading 
    tactics. This adaptive quality makes ER the foundation for Kaufman's Adaptive Moving Average (KAMA) and numerous 
    other adaptive indicators that adjust their behavior based on market efficiency.
  </p>

  <h2>How It Works</h2>
  <p>ER calculates the ratio of directional movement to total movement:</p>
  <ol>
    <li><strong>Calculate Direction:</strong> Net change from N periods ago to now</li>
    <li><strong>Calculate Volatility:</strong> Sum of all absolute price changes</li>
    <li><strong>Compute Ratio:</strong> Direction divided by Volatility</li>
    <li><strong>Normalize:</strong> Result ranges from 0 (no efficiency) to 1 (perfect efficiency)</li>
    <li><strong>Interpret:</strong> Higher values indicate stronger trends</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200">
      Direction = |Close - Close[period]|<br/>
      <br/>
      Volatility = Σ|Close[i] - Close[i-1]| for i = 1 to period<br/>
      <br/>
      Efficiency Ratio = Direction / Volatility<br/>
      <br/>
      ER Properties:<br/>
      - Range: 0 to 1<br/>
      - ER = 1: Perfect trend (straight line)<br/>
      - ER = 0: Perfect noise (no net movement)<br/>
      - ER > 0.6: Strong trend<br/>
      - ER &lt; 0.3: Choppy market<br/>
      <br/>
      Practical Interpretation:<br/>
      High ER: Price moved efficiently to destination<br/>
      Low ER: Price took a wandering path<br/>
      <br/>
      For Adaptive Indicators:<br/>
      Scaling Factor = ER × (Fast SC - Slow SC) + Slow SC<br/>
      Where SC = Smoothing Constant
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Market State Detection:</strong> Identifies trending vs ranging conditions</li>
    <li><strong>Adaptive Foundation:</strong> Core component for adaptive indicators</li>
    <li><strong>Noise Filter:</strong> Quantifies signal-to-noise ratio in price</li>
    <li><strong>Universal Application:</strong> Works across all markets and timeframes</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>ER Analysis</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Market Conditions:</h4>
    <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">ER > 0.6:</strong> Strong trending market, use trend strategies</li>
      <li><strong class="text-gray-900 dark:text-gray-100">ER 0.3-0.6:</strong> Moderate trend, mixed strategies</li>
      <li><strong class="text-gray-900 dark:text-gray-100">ER &lt; 0.3:</strong> Choppy market, avoid trend following</li>
      <li><strong class="text-gray-900 dark:text-gray-100">ER Rising:</strong> Trend developing or strengthening</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Trading Applications:</h4>
    <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Position Sizing:</strong> Larger positions when ER is high</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Strategy Selection:</strong> Trend vs mean reversion based on ER</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Stop Placement:</strong> Tighter stops in high ER markets</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Indicator Tuning:</strong> Adjust parameters based on ER</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Adaptive Trading:</strong>
      <ul>
        <li>Use trend-following when ER > 0.4</li>
        <li>Switch to mean reversion when ER &lt; 0.3</li>
        <li>Scale position size with ER level</li>
        <li>Adjust stop distances inversely to ER</li>
      </ul>
    </li>
    <li><strong>ER Breakout System:</strong>
      <ul>
        <li>Wait for ER to exceed 0.5 threshold</li>
        <li>Enter in direction of price movement</li>
        <li>Exit when ER drops below 0.3</li>
        <li>Use ER spikes as breakout confirmation</li>
      </ul>
    </li>
    <li><strong>Market Regime Filter:</strong>
      <ul>
        <li>Calculate long-term average ER</li>
        <li>Trade only when current ER > average</li>
        <li>Increase leverage in high ER periods</li>
        <li>Go flat in very low ER conditions</li>
      </ul>
    </li>
    <li><strong>KAMA Implementation:</strong> Use ER to create adaptive moving average</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>Multi-Period ER:</strong> Compare different period ERs for confirmation</li>
    <li><strong>ER Momentum:</strong> Trade rate of change in efficiency</li>
    <li><strong>Fractal Efficiency:</strong> Apply ER across multiple timeframes</li>
    <li><strong>ER Bands:</strong> Create adaptive bands using ER scaling</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Quantifies market trending behavior</li>
    <li>Simple yet powerful calculation</li>
    <li>Foundation for adaptive systems</li>
    <li>Works in all market conditions</li>
    <li>No lag in efficiency measurement</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Doesn't indicate trend direction</li>
    <li>Can spike on single large moves</li>
    <li>Period selection affects results</li>
    <li>May give false signals during news</li>
    <li>Works best with other indicators</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>ER enhances many trading systems:</p>
  <ul>
    <li><strong>Moving Averages:</strong> Create adaptive MAs using ER</li>
    <li><strong>ATR:</strong> Combine ER with volatility for complete picture</li>
    <li><strong>ADX:</strong> Compare trend strength measures</li>
    <li><strong>Oscillators:</strong> Filter oscillator signals by ER level</li>
    <li><strong>Breakout Systems:</strong> Confirm breakouts with rising ER</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical elegance of the Efficiency Ratio lies in its fractal nature—it essentially measures the fractal 
    dimension of price movement. In geometry, the most efficient path between two points is a straight line (dimension 1), 
    while a path that wanders randomly has a higher fractal dimension approaching 2. ER quantifies where price movement 
    falls on this spectrum, with trending markets showing more line-like behavior and choppy markets exhibiting more 
    plane-filling characteristics.
  </p>
  <p>
    Kaufman's insight was recognizing that this geometric property could be calculated simply by comparing displacement 
    to distance traveled. This ratio naturally adapts to market conditions without requiring complex calculations or 
    assumptions about market structure. The result is a robust, parameter-light indicator that captures an essential 
    property of price behavior—its tendency to trend—in a single normalized value that can drive adaptive trading 
    systems across any market or timeframe.
  </p>
</IndicatorLayout>