---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'ht_trendmode';
const indicatorName = 'Hilbert Transform - Trend vs Cycle Mode';
const description = `The Hilbert Transform Trend vs Cycle Mode indicator identifies whether the market is currently trending or cycling by analyzing the dominant cycle phase behavior, outputting 1 for trending markets and 0 for cycling markets.`;
const parameters: Array<{
  name: string;
  type: 'number' | 'boolean';
  default: any;
  min?: number;
  max?: number;
  description?: string;
}> = [];  // Hilbert Transform indicators are typically parameter-free
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    The Hilbert Transform - Trend vs Cycle Mode indicator, developed by John Ehlers, provides a 
    binary classification of market behavior: trending (1) or cycling (0). This indicator analyzes 
    the rate of change in the dominant cycle phase to determine if the market is exhibiting 
    directional trending behavior or oscillating in a sideways cycle pattern. This critical 
    distinction allows traders to apply the appropriate strategy for current market conditions.
  </p>
  <p>
    The indicator works by examining how consistently the phase advances. In a trending market, 
    the phase advances irregularly or may even stall, as the trend component dominates over cycles. 
    In a cycling market, the phase advances steadily and predictably. By quantifying this behavior, 
    the Trend vs Cycle Mode indicator provides an objective measure of market state that can be 
    used to switch between trend-following and mean-reversion strategies automatically.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Output Values</h3>
  <ul>
    <li><strong>1 (Trending):</strong> Market is in a directional trend mode</li>
    <li><strong>0 (Cycling):</strong> Market is in a sideways cycling mode</li>
    <li><strong>Transitions:</strong> Changes from 0 to 1 or 1 to 0 indicate regime shifts</li>
    <li><strong>Persistence:</strong> Mode tends to persist for multiple bars</li>
  </ul>

  <h3>Market Characteristics</h3>
  <ul>
    <li><strong>Trending Mode (1):</strong>
      <ul>
        <li>Strong directional movement</li>
        <li>Cycles are suppressed or irregular</li>
        <li>Use trend-following strategies</li>
        <li>Avoid mean reversion trades</li>
      </ul>
    </li>
    <li><strong>Cycling Mode (0):</strong>
      <ul>
        <li>Sideways, range-bound movement</li>
        <li>Regular oscillations present</li>
        <li>Use mean reversion strategies</li>
        <li>Avoid trend-following trades</li>
      </ul>
    </li>
  </ul>

  <h3>Strategy Selection</h3>
  <ul>
    <li><strong>Mode = 1:</strong> Activate breakout systems, moving average crosses, momentum strategies</li>
    <li><strong>Mode = 0:</strong> Activate oscillators, support/resistance trades, cycle strategies</li>
    <li><strong>Mode changes:</strong> Often mark significant market turning points</li>
    <li><strong>Mode persistence:</strong> Stay with appropriate strategy until mode changes</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>The Trend vs Cycle Mode calculation process:</p>
  <ol>
    <li><strong>Calculate Dominant Cycle Phase:</strong> Using Hilbert Transform</li>
    <li><strong>Measure Phase Advance Rate:</strong> Track how phase changes between bars</li>
    <li><strong>Compute Phase Stability:</strong> Analyze consistency of phase advancement</li>
    <li><strong>Apply Trend Detection Logic:</strong>
      <ul>
        <li>If phase advance is irregular or stalls → Trending (1)</li>
        <li>If phase advance is steady and consistent → Cycling (0)</li>
      </ul>
    </li>
    <li><strong>Smooth Output:</strong> Apply median filter to reduce mode flipping</li>
    <li><strong>Apply Hysteresis:</strong> Prevent rapid mode changes</li>
  </ol>
  <p>
    The key insight is that trending markets disrupt the regular phase advancement seen in cycles. 
    By detecting this disruption, the indicator can reliably distinguish between the two market states.
  </p>

  <h2 id="parameters">Parameters</h2>
  <p>
    The Hilbert Transform Trend vs Cycle Mode has no user-adjustable parameters. The indicator uses 
    fixed internal thresholds and logic based on extensive research to determine market mode. This 
    parameter-free design ensures consistent mode detection across all markets and timeframes.
  </p>
  <p>
    Internal settings include:
  </p>
  <ul>
    <li><strong>Phase variance threshold:</strong> Determines trend vs cycle classification</li>
    <li><strong>Smoothing period:</strong> Typically 5-10 bars to stabilize output</li>
    <li><strong>Hysteresis band:</strong> Prevents mode flipping on borderline conditions</li>
    <li><strong>Initialization period:</strong> ~50 bars for Hilbert Transform</li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The indicator returns a binary mode classification:</p>
  <ul>
    <li><strong>Type:</strong> Array of integers (0 or 1)</li>
    <li><strong>Values:</strong> 0 = Cycling, 1 = Trending</li>
    <li><strong>Transitions:</strong> Typically smooth, not rapidly switching</li>
    <li><strong>Persistence:</strong> Mode usually persists for 20+ bars minimum</li>
    <li><strong>Initial values:</strong> Requires ~50 bars to stabilize</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. Adaptive Strategy Switching</h3> <p>Automatically switch between strategies based on market mode:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. Risk Management Adaptation</h3> <p>Adjust risk parameters based on market mode:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. Multi-Indicator Confirmation</h3> <p>Combine mode with other indicators for robust signals:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>Mode flickering:</strong> Rapid switching in transitional markets</li>
    <li><strong>Initialization delay:</strong> Requires ~50 bars for accurate mode detection</li>
    <li><strong>Borderline markets:</strong> Markets between trending and cycling may be misclassified</li>
    <li><strong>News events:</strong> Sudden volatility can cause temporary mode misreading</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Wait for mode to stabilize before taking signals</li>
    <li>Use mode duration as a quality filter</li>
    <li>Flatten positions on mode transitions</li>
    <li>Combine with volatility filters for confirmation</li>
    <li>Backtest strategies separately for each mode</li>
    <li>Monitor mode distribution for market insights</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Ehlers, J. F. (2001). <em>Rocket Science for Traders</em>. John Wiley & Sons.</li>
    <li>Ehlers, J. F. (2004). "The Trend Mode Indicator". <em>Technical Analysis of Stocks & Commodities</em>.</li>
    <li>Market regime detection and adaptive trading systems</li>
    <li>Phase-based market classification techniques</li>
  </ul>
</IndicatorLayout>
