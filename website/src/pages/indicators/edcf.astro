---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'edcf';
const indicatorName = 'Ehlers Distance Coefficient Filter (EDCF)';
const description = `The Ehlers Distance Coefficient Filter (EDCF) is an advanced signal processing indicator developed by John Ehlers that uses statistical distance measurements to create an adaptive filter. By measuring how far current prices deviate from recent behavior, EDCF creates a responsive yet smooth indicator that excels at identifying trend changes while filtering market noise.`;
const parameters = [
  {
    "name": "period",
    "type": "number",
    "default": 20,
    "min": 10,
    "max": 50,
    "description": "Lookback period for distance coefficient calculation"
  },
  {
    "name": "smoothing",
    "type": "number",
    "default": 5,
    "min": 2,
    "max": 10,
    "description": "Smoothing factor for the filter output"
  }
];
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2>Overview</h2>
  <p>
    The Ehlers Distance Coefficient Filter (EDCF) represents John Ehlers' innovative application of statistical 
    distance theory to financial markets. This sophisticated indicator measures the "distance" between current price 
    behavior and recent price patterns, using this information to create an adaptive filter that responds quickly to 
    genuine market changes while ignoring random noise. The result is a remarkably smooth yet responsive indicator 
    that excels at identifying the onset of new trends.
  </p>
  <p>
    What sets EDCF apart from traditional filters is its adaptive nature. Rather than using fixed weights or periods, 
    it dynamically adjusts its responsiveness based on how "different" current price action is from recent behavior. 
    When prices begin moving in a new direction, the distance coefficient increases, causing the filter to respond 
    more quickly. During stable trends or consolidations, the filter becomes more stable, reducing whipsaw signals 
    that plague many other indicators.
  </p>

  <h2>How It Works</h2>
  <p>EDCF employs sophisticated statistical distance calculations:</p>
  <ol>
    <li><strong>Calculate Price Vector:</strong> Create array of recent price changes</li>
    <li><strong>Compute Distance:</strong> Measure statistical distance from average behavior</li>
    <li><strong>Normalize Coefficient:</strong> Convert distance to 0-1 coefficient</li>
    <li><strong>Apply Adaptive Filter:</strong> Use coefficient to weight current vs. historical data</li>
    <li><strong>Smooth Output:</strong> Apply final smoothing for stability</li>
  </ol>
  
  <div class="not-prose bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
    <p class="font-mono text-sm mb-0 text-gray-800 dark:text-gray-200">
      For each bar:<br/>
      Price Vector = [Close - Close[1], Close[1] - Close[2], ..., Close[n-1] - Close[n]]<br/>
      <br/>
      Mean Vector = Average of recent price vectors<br/>
      <br/>
      Distance = √(Σ(Price Vector[i] - Mean Vector[i])²)<br/>
      <br/>
      Normalized Distance = Distance / Max Distance over Period<br/>
      <br/>
      Filter Coefficient = 2 / (1 + exp(-Normalized Distance)) - 1<br/>
      <br/>
      Adaptive Filter = α × Close + (1 - α) × Filter[1]<br/>
      Where α = Filter Coefficient × Base Alpha<br/>
      <br/>
      EDCF = EMA(Adaptive Filter, Smoothing Period)
    </p>
  </div>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Adaptive Response:</strong> Automatically adjusts to market conditions</li>
    <li><strong>Statistical Foundation:</strong> Based on distance theory mathematics</li>
    <li><strong>Noise Reduction:</strong> Superior filtering of market noise</li>
    <li><strong>Early Detection:</strong> Identifies trend changes quickly</li>
  </ul>

  <h2>Interpretation & Trading Signals</h2>
  
  <h3>EDCF Analysis</h3>
  <div class="not-prose bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg my-4 border border-blue-200 dark:border-blue-800">
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Filter Behavior:</h4>
    <ul class="list-disc list-inside mb-4 text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Rising EDCF:</strong> Upward price momentum detected</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Falling EDCF:</strong> Downward price momentum detected</li>
      <li><strong class="text-gray-900 dark:text-gray-100">EDCF Slope Change:</strong> Potential trend reversal</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Smooth EDCF:</strong> Stable trend in progress</li>
    </ul>
    
    <h4 class="font-semibold mb-2 text-lg text-blue-900 dark:text-blue-100">Trading Signals:</h4>
    <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
      <li><strong class="text-gray-900 dark:text-gray-100">Price Cross Above EDCF:</strong> Bullish momentum shift</li>
      <li><strong class="text-gray-900 dark:text-gray-100">Price Cross Below EDCF:</strong> Bearish momentum shift</li>
      <li><strong class="text-gray-900 dark:text-gray-100">EDCF Acceleration:</strong> Trend strengthening</li>
      <li><strong class="text-gray-900 dark:text-gray-100">EDCF Deceleration:</strong> Trend weakening</li>
    </ul>
  </div>

  <h3>Trading Strategies</h3>
  <ul>
    <li><strong>Trend Following:</strong>
      <ul>
        <li>Enter long when price crosses above rising EDCF</li>
        <li>Enter short when price crosses below falling EDCF</li>
        <li>Use EDCF as trailing stop</li>
        <li>Exit when EDCF slope reverses</li>
      </ul>
    </li>
    <li><strong>Momentum Confirmation:</strong>
      <ul>
        <li>Buy when EDCF turns up and accelerates</li>
        <li>Sell when EDCF turns down and accelerates</li>
        <li>Avoid trades when EDCF is flat</li>
        <li>Use distance coefficient for position sizing</li>
      </ul>
    </li>
    <li><strong>Support/Resistance:</strong>
      <ul>
        <li>EDCF acts as dynamic support in uptrends</li>
        <li>EDCF acts as dynamic resistance in downtrends</li>
        <li>Trade bounces off EDCF in trend direction</li>
        <li>Look for failed tests as reversal signals</li>
      </ul>
    </li>
    <li><strong>Filter Divergence:</strong> Compare price extremes with EDCF extremes</li>
  </ul>

  <h3>Advanced Techniques</h3>
  <ul>
    <li><strong>Multi-Period EDCF:</strong> Layer different periods for confirmation</li>
    <li><strong>Distance Analysis:</strong> Use raw distance coefficient for volatility</li>
    <li><strong>EDCF Bands:</strong> Create envelope around EDCF for targets</li>
    <li><strong>Composite Filtering:</strong> Combine with other Ehlers indicators</li>
  </ul>

  <h2>Practical Application</h2>
  
  <h3>Strengths</h3>
  <ul>
    <li>Adapts automatically to market conditions</li>
    <li>Excellent noise filtering capabilities</li>
    <li>Early trend change detection</li>
    <li>Smooth output reduces false signals</li>
    <li>Based on solid mathematical theory</li>
  </ul>

  <h3>Limitations</h3>
  <ul>
    <li>Complex calculation requires understanding</li>
    <li>May lag in extremely volatile conditions</li>
    <li>Parameter optimization needed per market</li>
    <li>Less intuitive than simple moving averages</li>
    <li>Computational intensity higher than basic indicators</li>
  </ul>

  <h2>Combination with Other Indicators</h2>
  <p>EDCF works exceptionally well with:</p>
  <ul>
    <li><strong>Ehlers Indicators:</strong> Combine with MESA, Cyber Cycle</li>
    <li><strong>Momentum Oscillators:</strong> Use RSI/MACD for timing</li>
    <li><strong>Volatility Measures:</strong> ATR for stop placement</li>
    <li><strong>Volume Analysis:</strong> Confirm EDCF signals with volume</li>
    <li><strong>Market Structure:</strong> Trade EDCF signals at key levels</li>
  </ul>

  <h2>Example Usage</h2>
  <p>Code examples will be available once the Rust implementation is complete.</p>

  <h2>Mathematical Background</h2>
  <p>
    The mathematical foundation of EDCF rests on the concept of statistical distance in multi-dimensional space. By 
    treating price movements as vectors in n-dimensional space (where n is the lookback period), EDCF calculates the 
    Euclidean distance between the current price vector and the average price vector. This distance measurement 
    captures how "unusual" current price behavior is compared to recent norms.
  </p>
  <p>
    The genius of the indicator lies in converting this distance measurement into an adaptive filter coefficient using 
    a sigmoid transformation. This creates a smooth, bounded coefficient that increases filter responsiveness when 
    prices behave unusually (high distance) and decreases it during normal market conditions (low distance). The final 
    exponential smoothing ensures the output remains tradeable while preserving the adaptive characteristics that make 
    EDCF superior to fixed-parameter filters.
  </p>

</IndicatorLayout>