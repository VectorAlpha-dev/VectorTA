---
import IndicatorLayout from '../../layouts/IndicatorLayout.astro';

const indicatorId = 'ht_phasor';
const indicatorName = 'Hilbert Transform - Phasor';
const description = `The Hilbert Transform Phasor indicator decomposes price data into two components - In-phase and Quadrature - that together form a phasor rotating in the complex plane, providing a powerful method for analyzing market cycles and their instantaneous characteristics.`;
const parameters: Array<{
  name: string;
  type: 'number' | 'boolean';
  default: any;
  min?: number;
  max?: number;
  description?: string;
}> = [];  // Hilbert Transform indicators are typically parameter-free
---

<IndicatorLayout
  indicatorId={indicatorId}
  indicatorName={indicatorName}
  description={description}
  parameters={parameters}
>
  <h2 id="overview">Overview</h2>
  <p>
    The Hilbert Transform - Phasor is a sophisticated signal processing indicator that represents 
    price movements as a rotating vector (phasor) in the complex plane. Developed by John Ehlers, 
    this indicator outputs two components: the In-phase (I) component, which represents the real 
    part, and the Quadrature (Q) component, which represents the imaginary part lagging by 90 degrees.
  </p>
  <p>
    Together, these components form a phasor that rotates counterclockwise in the I-Q plane at a 
    rate determined by the dominant cycle frequency. The length of the phasor represents the cycle 
    amplitude, while its angle represents the phase. This representation allows traders to visualize 
    and analyze market cycles in a way that's impossible with traditional indicators, providing 
    insights into both cycle strength and position simultaneously.
  </p>

  <h2 id="interpretation">Interpretation</h2>
  <h3>Phasor Components</h3>
  <ul>
    <li><strong>In-phase (I):</strong> The real component, representing current cycle amplitude</li>
    <li><strong>Quadrature (Q):</strong> The imaginary component, lagging I by 90°</li>
    <li><strong>Phasor length:</strong> √(I² + Q²) indicates cycle strength</li>
    <li><strong>Phasor angle:</strong> atan2(Q, I) indicates cycle phase</li>
  </ul>

  <h3>Phasor Behavior</h3>
  <ul>
    <li><strong>Circular motion:</strong> Steady cycles produce circular phasor rotation</li>
    <li><strong>Expanding spiral:</strong> Increasing cycle amplitude</li>
    <li><strong>Contracting spiral:</strong> Decreasing cycle amplitude</li>
    <li><strong>Erratic motion:</strong> Indicates choppy, non-cyclical market</li>
  </ul>

  <h3>Trading Applications</h3>
  <ul>
    <li><strong>Cycle identification:</strong> Clear rotation indicates dominant cycle</li>
    <li><strong>Trend detection:</strong> Phasor drift indicates underlying trend</li>
    <li><strong>Momentum:</strong> Rate of rotation shows cycle frequency</li>
    <li><strong>Volatility:</strong> Phasor length variations indicate volatility changes</li>
  </ul>

  <h2 id="calculation">Calculation</h2>
  <p>The Hilbert Transform Phasor calculation involves:</p>
  <ol>
    <li><strong>Price Smoothing:</strong> Apply 4-bar WMA to reduce noise</li>
    <li><strong>Detrending:</strong> Remove trend component using high-pass filter</li>
    <li><strong>Hilbert Transform:</strong>
      <ul>
        <li>In-phase (I) = Detrended price</li>
        <li>Quadrature (Q) = Hilbert Transform of detrended price</li>
      </ul>
    </li>
    <li><strong>Hilbert Transform calculation:</strong>
      <ul>
        <li>Q[0] = 0.0962 * Price[0] + 0.5769 * Price[2] - 0.5769 * Price[4] - 0.0962 * Price[6]</li>
        <li>Weighted by coefficients derived from sine function</li>
      </ul>
    </li>
    <li><strong>Smoothing:</strong> Apply exponential smoothing to both components</li>
  </ol>
  <p>
    The Hilbert Transform creates a 90-degree phase shift, which when combined with the original 
    signal, allows for instantaneous phase and amplitude measurements. The transform uses specific 
    coefficients that approximate an ideal 90-degree phase shifter over the frequency range of 
    interest.
  </p>

  <h2 id="parameters">Parameters</h2>
  <p>
    The Hilbert Transform Phasor has no user-adjustable parameters. The algorithm uses fixed 
    coefficients derived from signal processing theory to ensure optimal phase relationships. 
    This parameter-free design ensures consistent results and eliminates the need for optimization.
  </p>
  <p>
    Internal constants include:
  </p>
  <ul>
    <li><strong>Hilbert coefficients:</strong> [0.0962, 0.5769, -0.5769, -0.0962]</li>
    <li><strong>Smoothing factor:</strong> Typically 0.15 for exponential smoothing</li>
    <li><strong>Detrending period:</strong> Usually 48 bars for high-pass filter</li>
  </ul>

  <h2 id="returns">Returns & Output</h2>
  <p>The Phasor indicator returns two arrays:</p>
  <ul>
    <li><strong>In-phase (I):</strong> Real component array</li>
    <li><strong>Quadrature (Q):</strong> Imaginary component array</li>
    <li><strong>Type:</strong> Two arrays of floating-point numbers</li>
    <li><strong>Range:</strong> Typically ±2-3% of price (after detrending)</li>
    <li><strong>Relationship:</strong> Q lags I by 90 degrees</li>
    <li><strong>Initial values:</strong> Requires ~50 bars to stabilize</li>
  </ul>

  <h2 id="usage">Example Usage</h2>
  <h3>Rust Implementation</h3>
  <pre><code class="language-rust"> // Rust implementation example will be added here
</code></pre>

  <h3>Python Integration</h3> <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="use-cases"> Common Use Cases</h2> <h3>1. Cycle Strength Analysis</h3> <p>Measure and trade based on cycle strength:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>2. Phasor Rotation Trading</h3> <p>Trade based on phasor rotation patterns:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h3>3. Phasor Divergence Detection</h3> <p>Identify divergences between price and phasor:</p>
  <pre><code class="language-python"> # Python implementation example will be added here
</code></pre>

  <h2 id="edge-cases"> Edge Cases & Errors</h2>
  <h3>Common Issues</h3>
  <ul>
    <li><strong>Initialization period:</strong> Requires ~50 bars for stable output</li>
    <li><strong>Trending markets:</strong> Phasor may drift instead of rotating</li>
    <li><strong>Low volatility:</strong> Very small phasor magnitude makes analysis difficult</li>
    <li><strong>Phase wrapping:</strong> Angle calculations must handle ±180° transitions</li>
  </ul>

  <h3>Best Practices</h3>
  <ul>
    <li>Normalize magnitude by price for consistent analysis</li>
    <li>Use both components together, not separately</li>
    <li>Monitor rotation quality for cycle validity</li>
    <li>Combine with other Hilbert indicators (period, phase)</li>
    <li>Account for phasor drift in trending markets</li>
    <li>Handle phase wrapping in all angle calculations</li>
  </ul>

  <h2 id="references">References</h2>
  <ul>
    <li>Ehlers, J. F. (2001). <em>Rocket Science for Traders</em>. John Wiley & Sons.</li>
    <li>Ehlers, J. F. (2013). <em>Cycle Analytics for Traders</em>. John Wiley & Sons.</li>
    <li>Complex signal representation and phasor theory</li>
    <li>Hilbert Transform properties and applications</li>
  </ul>
</IndicatorLayout>
