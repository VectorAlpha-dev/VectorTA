---
import { indicators } from '../../data/indicator-registry';
import { CategoryIcon } from './CategoryIcon';

export interface Props {
  currentIndicator: string;
}

const { currentIndicator } = Astro.props;

// Get current indicator info
const current = indicators[currentIndicator];
if (!current) return null;

// Find related indicators
const related = Object.entries(indicators)
  .filter(([id, indicator]) => {
    if (id === currentIndicator) return false;
    
    // Same category
    if (indicator.category === current.category) return true;
    
    // Similar names (e.g., SMA, EMA, DEMA all have "MA")
    const currentWords = currentIndicator.toLowerCase().split(/[_-]/);
    const indicatorWords = id.toLowerCase().split(/[_-]/);
    const commonWords = currentWords.filter(word => 
      indicatorWords.some(w => w.includes(word) || word.includes(w))
    );
    
    return commonWords.length > 0;
  })
  .slice(0, 6)
  .map(([id, indicator]) => ({ id, ...indicator }));

if (related.length === 0) return null;
---

<section class="mt-12 pt-8 border-t border-border">
  <h2 class="text-2xl font-bold mb-6">Related Indicators</h2>
  
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {related.map((indicator) => (
      <a
        href={`/indicators/${indicator.id}`}
        class="card hover:shadow-lg transition-all hover:scale-[1.02] group"
      >
        <div class="flex items-start gap-3">
          <div class="p-2 bg-muted rounded-lg group-hover:bg-primary/10 transition-colors">
            <CategoryIcon category={indicator.category} className="w-5 h-5 text-muted-foreground group-hover:text-primary" />
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-foreground group-hover:text-primary transition-colors line-clamp-1">
              {indicator.name}
            </h3>
            <p class="text-sm text-muted-foreground line-clamp-2 mt-1">
              {indicator.description || `${indicator.category.replace(/_/g, ' ')} indicator`}
            </p>
          </div>
        </div>
      </a>
    ))}
  </div>
</section>