---
import { indicators } from '../../data/indicator-registry';

// Group indicators by category
const categorizedIndicators = Object.entries(indicators).reduce((acc, [id, indicator]) => {
  const category = indicator.category || 'Other';
  if (!acc[category]) acc[category] = [];
  acc[category].push({ id, ...indicator });
  return acc;
}, {} as Record<string, any[]>);

// Sort categories and indicators within each category
const sortedCategories = Object.entries(categorizedIndicators)
  .sort(([a], [b]) => a.localeCompare(b))
  .map(([category, items]) => ({
    category,
    items: items.sort((a, b) => a.name.localeCompare(b.name))
  }));

const currentPath = Astro.url.pathname;
---

<aside 
  id="sidebar"
  class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-card border-r border-border overflow-y-auto z-40 lg:z-30 -translate-x-full lg:translate-x-0"
>
  <nav class="p-4 space-y-6">
    <!-- Home link -->
    <a 
      href="/" 
      class={`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors font-medium ${
        currentPath === '/' 
          ? 'bg-primary text-primary-foreground' 
          : 'hover:bg-muted text-muted-foreground hover:text-foreground'
      }`}
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
      </svg>
      Home
    </a>
    
    <!-- Categories -->
    <div class="space-y-4">
      {sortedCategories.map(({ category, items }) => (
        <div>
          <h3 class="px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider">
            {category.replace(/_/g, ' ')}
          </h3>
          <div class="space-y-1">
            {items.map(indicator => {
              const isActive = currentPath === `/indicators/${indicator.id}`;
              return (
                <a 
                  href={`/indicators/${indicator.id}`}
                  class={`block px-3 py-1.5 text-sm rounded-lg transition-colors ${
                    isActive
                      ? 'bg-primary/10 text-primary font-medium' 
                      : 'text-muted-foreground hover:text-foreground hover:bg-muted'
                  }`}
                >
                  {indicator.name}
                </a>
              );
            })}
          </div>
        </div>
      ))}
    </div>
    
    <!-- Footer -->
    <div class="border-t border-border pt-4 mt-8">
      <div class="px-3 text-xs text-muted-foreground">
        <p>{Object.keys(indicators).length} indicators available</p>
        <p class="mt-1">Powered by VectorTA</p>
      </div>
    </div>
  </nav>
</aside>

<style>
  /* Custom scrollbar for sidebar */
  #sidebar {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--border)) transparent;
  }
  
  #sidebar::-webkit-scrollbar {
    width: 6px;
  }
  
  #sidebar::-webkit-scrollbar-track {
    background: transparent;
  }
  
  #sidebar::-webkit-scrollbar-thumb {
    background-color: hsl(var(--border));
    border-radius: 3px;
  }
  
  #sidebar::-webkit-scrollbar-thumb:hover {
    background-color: hsl(var(--muted-foreground) / 0.3);
  }
</style>