---
import { indicators } from '../../data/indicator-registry';

const pathname = Astro.url.pathname;
const segments = pathname.split('/').filter(Boolean);

// Build breadcrumb items
const breadcrumbs = [];

// Always include home
breadcrumbs.push({ label: 'Home', href: '/', isLast: segments.length === 0 });

// Build the rest
let currentPath = '';
segments.forEach((segment, index) => {
  currentPath += `/${segment}`;
  const isLast = index === segments.length - 1;
  
  let label = segment;
  
  // Special handling for known paths
  if (segment === 'indicators' && index === 0) {
    label = 'Indicators';
  } else if (segments[0] === 'indicators' && index === 1) {
    // This is an indicator ID, try to get its name
    const indicator = indicators[segment as keyof typeof indicators];
    if (indicator) {
      label = indicator.name;
    }
  } else {
    // Format segment name
    label = segment.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
  }
  
  breadcrumbs.push({
    label,
    href: currentPath,
    isLast
  });
});
---

<nav aria-label="Breadcrumb" class="mb-6">
  <ol class="flex items-center space-x-2 text-sm">
    {breadcrumbs.map((crumb, index) => (
      <>
        {index > 0 && (
          <li class="text-muted-foreground">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
        )}
        <li>
          {crumb.isLast ? (
            <span class="text-foreground font-medium" aria-current="page">
              {crumb.label}
            </span>
          ) : (
            <a 
              href={crumb.href}
              class="text-muted-foreground hover:text-foreground transition-colors"
            >
              {crumb.label}
            </a>
          )}
        </li>
      </>
    ))}
  </ol>
</nav>
